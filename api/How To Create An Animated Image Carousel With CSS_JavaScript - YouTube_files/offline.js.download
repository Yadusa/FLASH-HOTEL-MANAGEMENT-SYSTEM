(function(g){var window=this;'use strict';var aXq=function(b){var L=new g.tO("und",new g.tP("Default","und",!0));L.captionTracks=b.captionTracks;return L},rnT=function(b){return new g.gF(function(L,q){var V=b.length,Q=[];
if(V)for(var G=function(O,B){V--;Q[O]=B;V==0&&L(Q)},R=function(O){q(O)},h,d=0;d<b.length;d++)h=b[d],g.B8T(h,g.DW(G,d),R);
else L(Q)})},t0=function(b){this.U=b},a_=function(){t0.apply(this,arguments)},Dmq=function(){a_.apply(this,arguments)},jD_=function(){a_.apply(this,arguments)},u$W=function(){a_.apply(this,arguments)},cn_=function(){a_.apply(this,arguments)},P7T=function(){a_.apply(this,arguments)},n8_=function(){a_.apply(this,arguments)},kJu=function(){a_.apply(this,arguments)},lXW=function(){t0.apply(this,arguments)},Anw=function(){a_.apply(this,arguments)},YG_=function(){a_.apply(this,arguments)},C7b=function(){a_.apply(this,
arguments)},mmR=function(){a_.apply(this,arguments)},sD_=function(){a_.apply(this,arguments)},X7Q=function(){a_.apply(this,arguments)},fX_=function(){a_.apply(this,arguments)},JnQ=function(){a_.apply(this,arguments)},Umq=function(){a_.apply(this,arguments)},bW8=function(){a_.apply(this,arguments)},LMT=function(){a_.apply(this,arguments)},q1R=function(){a_.apply(this,arguments)},Vnu=function(){t0.apply(this,arguments)},Qrs=function(){a_.apply(this,arguments)},GaR=function(){a_.apply(this,arguments)},
RzT=function(){a_.apply(this,arguments)},N88=function(){a_.apply(this,arguments)},oJR=function(){a_.apply(this,arguments)},hzw=function(){a_.apply(this,arguments)},dOw=function(){a_.apply(this,arguments)},OWy=function(){a_.apply(this,arguments)},B8u=function(){a_.apply(this,arguments)},EJb=function(){t0.apply(this,arguments)},FMT=function(){t0.apply(this,arguments)},pvu=function(){t0.apply(this,arguments)},Mns=function(){a_.apply(this,arguments)},ezT=function(){a_.apply(this,arguments)},T8s=function(){a_.apply(this,
arguments)},ZWQ=function(){a_.apply(this,arguments)},yYW=function(){a_.apply(this,arguments)},wvs=function(){a_.apply(this,arguments)},S1b=function(){a_.apply(this,arguments)},IyT=function(){a_.apply(this,arguments)},WM8=function(){a_.apply(this,arguments)},$O8=function(){a_.apply(this,arguments)},HWy=function(){a_.apply(this,arguments)},zz_=function(){a_.apply(this,arguments)},gJW=function(){a_.apply(this,arguments)},KMT=function(){a_.apply(this,arguments)},iWQ=function(){a_.apply(this,arguments)},
vJq=function(){a_.apply(this,arguments)},xO_=function(){a_.apply(this,arguments)},tnW=function(){a_.apply(this,arguments)},ay8=function(){a_.apply(this,arguments)},rYW=function(){a_.apply(this,arguments)},DOu=function(){a_.apply(this,arguments)},jr_=function(){a_.apply(this,arguments)},uiw=function(){a_.apply(this,arguments)},cYu=function(){a_.apply(this,arguments)},PlF=function(){a_.apply(this,arguments)},nJ_=function(){a_.apply(this,arguments)},ka_=function(){a_.apply(this,arguments)},ly_=function(){a_.apply(this,
arguments)},AYq=function(){a_.apply(this,arguments)},Y1R=function(){t0.apply(this,arguments)},ClW=function(){a_.apply(this,arguments)},mOy=function(){a_.apply(this,arguments)},sr_=function(){a_.apply(this,arguments)},Xvb=function(){a_.apply(this,arguments)},fyR=function(){a_.apply(this,arguments)},JYF=function(){a_.apply(this,arguments)},UO_=function(){a_.apply(this,arguments)},bDq=function(){a_.apply(this,arguments)},LW_=function(){a_.apply(this,arguments)},qbq=function(){a_.apply(this,arguments)},
VxF=function(){a_.apply(this,arguments)},Q7_=function(){a_.apply(this,arguments)},GsR=function(){a_.apply(this,arguments)},R4u=function(){a_.apply(this,arguments)},NA_=function(){a_.apply(this,arguments)},oQ_=function(){a_.apply(this,arguments)},h4w=function(){a_.apply(this,arguments)},diR=function(){a_.apply(this,arguments)},ODq=function(){a_.apply(this,arguments)},BAR=function(){a_.apply(this,arguments)},EQb=function(){a_.apply(this,arguments)},FW8=function(){a_.apply(this,arguments)},pj8=function(){a_.apply(this,
arguments)},MxQ=function(){a_.apply(this,arguments)},e4T=function(){a_.apply(this,arguments)},TAW=function(){a_.apply(this,arguments)},ZDb=function(){a_.apply(this,arguments)},yT_=function(){a_.apply(this,arguments)},wjb=function(){a_.apply(this,arguments)},SbW=function(){a_.apply(this,arguments)},Itu=function(){a_.apply(this,arguments)},WWW=function(){a_.apply(this,arguments)},$iq=function(){a_.apply(this,arguments)},HDs=function(){a_.apply(this,arguments)},z4T=function(b){b=b.key||b.id;
if(!b)throw Error("Entity key is missing");return b},gQT=function(){if(rI)return rI();
var b={};rI=g.Vx("PersistentEntityStoreDb",{Kg:(b.EntityStore={l0:1},b.EntityAssociationStore={l0:2},b),shared:!1,upgrade:function(L,q){q(1)&&g.DP(g.im(L,"EntityStore",{keyPath:"key"}),"entityType","entityType");q(2)&&(L=g.im(L,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.DP(L,"byParentEntityKey","parentEntityKey"),g.DP(L,"byChildEntityKey","childEntityKey"))},
version:3});return rI()},KWR=function(b){return g.AL(gQT(),b)},iDQ=function(b){return g.AL((0,g.Uus)(),b)},Df=function(b){this.token=b},jG=function(b,L){L=L===void 0?{}:L;
g.dU.call(this,g.bJw[b],Object.assign({},{name:"PESEncoderError",type:b},L));this.type=b;this.level="WARNING";Object.setPrototypeOf(this,jG.prototype)},vQq=function(b){return new jG("WRONG_DATA_TYPE",{i8:b})},xib=function(b){return b instanceof Error?new jG("UNKNOWN_ENCODE_ERROR",{originalMessage:b.message}):new jG("UNKNOWN_ENCODE_ERROR")},txw=function(b){return b instanceof Error?new jG("UNKNOWN_DECODE_ERROR",{originalMessage:b.message}):new jG("UNKNOWN_DECODE_ERROR")},aty=function(b,L){b=b instanceof
jG?b:L(b);
g.KB(b);throw b;},rTw=function(){},Diq=function(b,L,q){try{return b.B(L,q)}catch(V){aty(V,xib)}},j7w=function(b){b=(new TextEncoder).encode(b).subarray(0,16);
var L=new Uint8Array(16);L.set(b);return L},uP=function(b){this.U=b},cT_=function(b){var L=uET[b];
if(L)return L;g.vF(new g.dU("Entity model not found.",{entityType:b}))},PcW=function(b,L){this.U=b;
this.L=L;this.B={}},ksu=function(b,L){a:{b=nQT(b.L,L.version);
try{var q=b.L(L.data,L.key);break a}catch(V){aty(V,txw)}q=void 0}return q},cX=function(b,L,q){return b.U.objectStore("EntityStore").get(L).then(function(V){if(V){if(q&&V.entityType!==q)throw Error("Incorrect entity type");
return ksu(b,V)}})},PX=function(b,L,q){return q?(q=q.map(function(V){return cX(b,V,L)}),g.IX.all(q)):b.U.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(L)).then(function(V){return V.map(function(Q){return ksu(b,Q)})})},kU=function(b,L,q){var V=z4T(L),Q=nQT(b.L,1),G=Object.assign({},L);
return b.U.objectStore("EntityStore").get(V).then(function(R){if(R){if(R.entityType!==q)throw Error("Incorrect entity type");G.entityMetadata||(R=ksu(b,R),G.entityMetadata=R.entityMetadata)}}).then(function(){var R={key:V,
entityType:q,data:Diq(Q,G,V),version:1};return g.IX.all([g.tL(b.U.objectStore("EntityStore"),R),ltF(b,G,q)])}).then(function(){nZ(b,V,q);
return V})},AT8=function(b,L,q){L=L.map(function(V){return kU(b,V,q)});
return g.IX.all(L)},lP=function(b,L,q){if(q==null?0:q.VY){var V=new Set;
return Yb_(b,L,V).then(function(){for(var G=[],R=g.x(V),h=R.next();!h.done;h=R.next())G.push(lP(b,h.value));return g.IX.all(G).then(function(){})})}var Q=g.lB(L).entityType;
return g.IX.all([b.U.objectStore("EntityStore").delete(L),Ccs(b,L)]).then(function(){nZ(b,L,Q)})},miW=function(b,L){return g.Pm(b.U.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(L)},function(q){return g.IX.all([q.delete(),
Ccs(b,q.cursor.primaryKey)]).then(function(){nZ(b,q.cursor.primaryKey,L);return g.um(q)})})},s7W=function(b,L,q,V){var Q=nQT(b.L,1);
return cX(b,L,V).then(function(G){if(G){G=g.oO(G,q);var R={key:L,entityType:V,data:Diq(Q,G,L),version:1};return g.IX.all([g.tL(b.U.objectStore("EntityStore"),R),ltF(b,G,V)])}}).then(function(){nZ(b,L,V);
return L})},nZ=function(b,L,q){var V=b.B[q];
V||(V=new Set,b.B[q]=V);V.add(L)},Xjq=function(b,L,q){var V=z4T(L);
q=cT_(q);if(!q)return g.IX.resolve([]);q=new q(L);b=b.U.objectStore("EntityAssociationStore");L=[];q=g.x(q.L());for(var Q=q.next();!Q.done;Q=q.next())L.push(g.tL(b,{parentEntityKey:V,childEntityKey:Q.value}));return g.IX.all(L).then(function(G){return G.map(function(R){return R[1]})})},Ccs=function(b,L){return b.U.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(L))},ltF=function(b,L,q){var V=z4T(L);
return Ccs(b,V).then(function(){return Xjq(b,L,q)})},Yb_=function(b,L,q){if(q.has(L))return g.IX.resolve(void 0);
q.add(L);return ft8(b,L).then(function(V){return b.U.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(L)).then(function(){return V})}).then(function(V){var Q=g.IX.resolve(void 0);
V=g.x(V);for(var G=V.next(),R={};!G.done;R={MG:void 0},G=V.next())R.MG=G.value,Q=Q.then(function(h){return function(){return Yb_(b,h.MG,q)}}(R));
return Q}).then(function(){})},ft8=function(b,L){var q=b.U.objectStore("EntityAssociationStore");
return q.index("byParentEntityKey").getAll(IDBKeyRange.only(L)).then(function(V){var Q=[];V=g.x(V);for(var G=V.next();!G.done;G=V.next())G=G.value,Q.push(q.index("byChildEntityKey").getAll(G.childEntityKey));return g.IX.all(Q)}).then(function(V){var Q=[];
V=g.x(V);for(var G=V.next();!G.done;G=V.next())G=G.value,G.length===1&&Q.push(G[0].childEntityKey);return Q})},A0=function(){},JTq=function(){this.U={};
this.U[0]=new A0;if(!g.HB("aes_pes_encoder_killswitch")){var b=this.U;try{var L=g.fw();var q=j7w(L);var V=new uP(new g.G5(q),new g.Rd(q))}catch(Q){throw b=Q instanceof Error?new jG("KEY_CREATION_FAILED",{originalMessage:Q.message}):new jG("KEY_CREATION_FAILED"),g.KB(b),b;}b[1]=V}},nQT=function(b,L){L=L===void 0?0:L;
b=b.U[L];if(!b)throw L=new jG("INVALID_ENCODER_VERSION",{i8:L}),g.KB(L),L;return b},YU=function(b,L){g.l.call(this);
this.token=b;this.U=L;this.observers=[];b=new g.wW.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.fw());b.onmessage=this.L.bind(this);this.channel=b},CZ=function(b,L,q){var V,Q,G,R;
return g.P(function(h){if(h.U==1)return g.u(h,KWR(b.token),2);if(h.U!=3)return V=h.L,g.u(h,g.xc(V,["EntityStore","EntityAssociationStore"],L,function(d){Q=new PcW(d,b.U);return q(Q)}),3);
G=h.L;Q&&(R=Q.B,Object.keys(R).length>0&&(b.channel.postMessage(R),UiT(b,R)));return h.return(G)})},mK=function(b,L,q){return CZ(b,{mode:"readwrite",
qo:!0},function(V){return kU(V,L,q)})},bH_=function(b,L){return CZ(b,{mode:"readwrite",
qo:!0},function(q){return AT8(q,L,"offlineOrchestrationActionWrapperEntity")})},Lhy=function(b,L){return CZ(b,{mode:"readwrite",
qo:!0},function(q){return lP(q,L)})},qwy=function(b){return CZ(b,{mode:"readwrite",
qo:!0},function(L){return miW(L,"videoPlaybackPositionEntity")})},sH=function(b,L,q){return CZ(b,{mode:"readonly",
qo:!0},function(V){return cX(V,L,q)})},Xy=function(b,L,q){return CZ(b,{mode:"readonly",
qo:!0},function(V){return PX(V,L,q)})},UiT=function(b,L){b=g.x(b.observers);
for(var q=b.next();!q.done;q=b.next())q=q.value,q(L)},Vpq=function(){var b,L,q;
return g.P(function(V){if(V.U==1)return g.Rq(V,2),g.u(V,g.L5(),4);if(V.U!=2){b=V.L;if(!b||!g.JM()||typeof g.wW.BroadcastChannel==="undefined")return V.return();L=new JTq;return V.return(new YU(b,L))}q=g.dW(V);q instanceof Error&&g.KB(q);return V.return()})},fZ=function(){QQ_||(QQ_=Vpq());
return QQ_},Gu8=function(b){var L;
b=(L=b.options)==null?void 0:L.persistenceOption;return b==="ENTITY_PERSISTENCE_OPTION_PERSIST"||b==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},Rhb=function(b){var L;
return g.P(function(q){return q.U==1?g.u(q,fZ(),2):(L=q.L)?g.u(q,CZ(L,"readwrite",function(V){for(var Q={},G=g.x(b),R=G.next(),h={};!R.done;h={EK:void 0,cE:void 0},R=G.next())h.EK=R.value,h.EK.entityKey&&Gu8(h.EK)&&(h.cE=g.S8(h.EK.payload),R=void 0,h.EK.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(R=function(d){return function(){return kU(V,d.EK.payload[d.cE],d.cE)}}(h)),h.EK.type==="ENTITY_MUTATION_TYPE_DELETE"&&(R=function(d){return function(){return lP(V,d.EK.entityKey)}}(h)),h.EK.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(R=function(d){return function(){return s7W(V,d.EK.entityKey,d.EK.payload[d.cE],d.cE)}}(h)),R&&(Q[h.EK.entityKey]=Q[h.EK.entityKey]?Q[h.EK.entityKey].then(R):R()));
return g.IX.all(Object.values(Q))}),0):q.return()})},NvW=function(b){var L;
return g.P(function(q){if(q.U==1){L=b.mutations;if(!L||L.length<=0)return q.return();if(g.Fg){var V={type:"ENTITY_LOADED"};L!==void 0&&(V.payload=L);g.Fg.dispatch(V)}return g.u(q,Rhb(L),2)}L.length=0;g.GF(q)})},onW=function(b){return b!==void 0},hhF=function(b){var L=g.kL();
L=Object.assign({},L);b=Object.assign({},b);for(var q in L)b[q]?(L[q]!==4&&(L[q]=b[q]),delete b[q]):L[q]!==2&&(L[q]=4);Object.assign(L,b);g.FB5(L);JSON.stringify(L);return L},dFw=function(b){var L,q;
return g.P(function(V){if(V.U==1)return g.u(V,g.L5(),2);if(V.U!=3)return(L=V.L)?g.u(V,g.YL(L),3):V.return();q=V.L;return V.return(g.xc(q,["index","media","captions"],{mode:"readwrite",qo:!0},function(Q){var G=IDBKeyRange.bound(b+"|",b+"~");Q=[Q.objectStore("index").delete(G),Q.objectStore("media").delete(G),Q.objectStore("captions").delete(G)];return g.IX.all(Q).then(function(){})}))})},OHT=function(){var b,L;
return g.P(function(q){if(q.U==1)return g.u(q,g.L5(),2);if(q.U!=3){b=q.L;if(!b)throw g.wx("rvdfd");return g.u(q,g.YL(b),3)}L=q.L;return q.return(g.xc(L,["index","media"],{mode:"readwrite",qo:!0},function(V){var Q={};return g.jP(V.objectStore("index"),{},function(G){var R=G.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),h=g.IX.resolve(void 0);if(R){var d=R[1];R=R[2];Q[d]=Q[d]||{};var O;Q[d][R]=g.Zk$((O=G.getValue())==null?void 0:O.fmts)}else h=G.delete().then(function(){});
return g.IX.all([g.um(G),h]).then(function(B){return g.x(B).next().value})}).then(function(){for(var G={},R=g.x(Object.keys(Q)),h=R.next();!h.done;h=R.next()){h=h.value;
var d=Q[h].v;G[h]=Q[h].a&&d?1:2}var O=hhF(G);return g.VtT(V.objectStore("media"),{},function(B){var E=B.cursor.key.match(g.IEO);E&&G[E[1]]||V.objectStore("media").delete(B.cursor.key);return g.m9h(B)}).then(function(){return O})})}))})},Bvy=function(b,L){var q,V;
return g.P(function(Q){if(Q.U==1)return g.u(Q,g.L5(),2);if(Q.U!=3){q=Q.L;if(!q)throw g.wx("wct");return g.u(Q,g.YL(q),3)}V=Q.L;return g.u(Q,g.xc(V,["captions"],{mode:"readwrite",qo:!0},function(G){var R=[];G=G.objectStore("captions");for(var h=0;h<L.length;h++){var d=g.tL(G,L[h],b+"|"+L[h].metadata.vss_id);R.push(d)}return g.IX.all(R)}),0)})},En_=function(b){var L,q,V;
return g.P(function(Q){if(Q.U==1)return L=IDBKeyRange.bound(b+"|",b+"~"),g.u(Q,g.L5(),2);if(Q.U!=3){q=Q.L;if(!q)throw g.wx("gactfv");return g.u(Q,g.YL(q),3)}V=Q.L;return Q.return(V.getAll("captions",L))})},Fhu=function(b){return g.P(function(L){g.Au(b,0);
return L.return(dFw(b))})},pPw=function(b){return{context:g.fd(),
videoIds:b}},Mpq=function(b){return{context:g.fd(),
playlistIds:b}},ehu=function(b){return{context:g.fd(),
offlinePlaylistSyncChecks:b}},Tvq=function(){this.U=new Map},ydF=function(){ZHF||(ZHF=new Tvq);
return ZHF},wPW=function(b,L){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:b},metadata:L,statusCode:void 0,csn:void 0,can:void 0}},Sws=function(b,L,q){if(!q){var V=V===void 0?!1:V;
q=b.U.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!q||V)q=g.eb(16),b.U.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",q)}b={flowNonce:q,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:L.eventType};L.metadata&&(b.flowMetadata=L.metadata);L.statusCode!==void 0&&(b.flowEventStatus=L.statusCode);L.csn&&(b.csn=L.csn);L.can&&(b.can=L.can);g.pB("flowEvent",b,void 0)},Ipq=function(b){var L,q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT,v8,z,UT,Cy,hF;
return g.P(function(Ky){if(Ky.U==1)return g.u(Ky,CZ(b,{mode:"readonly",qo:!0},function(I){return PX(I,"playbackData").then(function(bh){var ws=bh.map(function(JF){return JF.transfer}).filter(function(JF){return!!JF}),o$=bh.map(function(JF){return JF.offlineVideoPolicy}).filter(function(JF){return!!JF}),m5=bh.filter(function(JF){return!!JF.key}).map(function(JF){return g.A2(g.lB(JF.key).entityId,"downloadStatusEntity")});
ws=PX(I,"transfer",ws);o$=PX(I,"offlineVideoPolicy",o$);m5=PX(I,"downloadStatusEntity",m5);var h3=ws.then(function(JF){JF=JF.reduce(function(qu,H9){(H9==null?0:H9.offlineVideoStreams)&&qu.push.apply(qu,g.a(H9.offlineVideoStreams));return qu},[]).filter(function(qu){return!!qu});
return PX(I,"offlineVideoStreams",JF)});
return g.IX.all([ws,o$,h3,m5]).then(function(JF){var qu=g.x(JF);JF=qu.next().value;var H9=qu.next().value;var H=qu.next().value;qu=qu.next().value;return[bh,JF,H9,H,qu]})})}),2);
if(Ky.U!=3)return L=Ky.L,g.u(Ky,CZ(b,{mode:"readonly",qo:!0},function(I){return PX(I,"mainDownloadsListEntity").then(function(bh){var ws,o$;return(o$=(ws=bh[0])==null?void 0:ws.downloads)!=null?o$:[]})}),3);
q=Ky.L;V=g.x(L);Q=V.next().value;G=V.next().value;R=V.next().value;h=V.next().value;d=V.next().value;O=Q;B=G;E=R;F=h;p=d;M={};y={};S={};v={};K={};t=[];r=g.x(B);for(k=r.next();!k.done;k=r.next())(n=k.value)&&(M[n.key]=n);G$=g.x(E);for(L3=G$.next();!L3.done;L3=G$.next())(VJ=L3.value)&&(y[VJ.key]=VJ);oY=g.x(p);for(Eo=oY.next();!Eo.done;Eo=oY.next())(qT=Eo.value)&&(S[qT.key]=qT);S5=g.x(F);for(f3=S5.next();!f3.done;f3=S5.next())(Nu=f3.value)&&(v[Nu.key]=Nu);PJ=g.x(q);for(X2=PJ.next();!X2.done;X2=PJ.next())Do=
X2.value,sT=void 0,K[(sT=Do.videoItem)!=null?sT:""]=!0,Do.videoItem&&(z=v8=void 0,UT=(z=(v8=g.lB(Do.videoItem))==null?void 0:v8.entityId)!=null?z:"",t.push({externalVideoId:UT}));Cy=O.filter(function(I){if(!I||!I.key||!I.offlineVideoPolicy)return!1;I=g.lB(I.key).entityId;I=g.A2(I,"downloadStatusEntity");var bh;return!(I&&((bh=S[I])==null?void 0:bh.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
hF=Cy.map(function(I){var bh=M[I.transfer],ws=[];if(bh==null?0:bh.offlineVideoStreams)for(var o$=g.x(bh.offlineVideoStreams),m5=o$.next();!m5.done;m5=o$.next())(m5=v[m5.value])&&ws.push(m5);o$=y[I.offlineVideoPolicy];m5=K;var h3=I==null?void 0:I.playerResponseTimestamp,JF=g.lB(o$.key).entityId;I=g.A2(JF,"mainVideoEntity");if(o$.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var qu="OFFLINE_VIDEO_STATE_DISABLED";o$.expirationTimestamp&&Number(o$.expirationTimestamp)<Date.now()/1E3&&(qu="OFFLINE_VIDEO_STATE_EXPIRED")}else if(o$.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")qu="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(bh==null?void 0:bh.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":qu="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":qu="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":qu="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":qu="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":qu="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":qu="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:qu="OFFLINE_VIDEO_STATE_UNKNOWN"}if(qu==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(bh==null?void 0:bh.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":qu="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":qu="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":qu=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}JF={id:JF,videoState:qu};if(bh==null?0:bh.cotn)JF.cotn=bh.cotn;if(bh==null?0:bh.maximumDownloadQuality)JF.selectedVideoQuality=bh==null?void 0:bh.maximumDownloadQuality;if(bh==null?0:bh.lastProgressTimeMs)JF.lastProgressTimeMs=bh.lastProgressTimeMs;h3&&(JF.playerResponseSavedTimeMs=String(Number(h3)*1E3));bh=String;h3=0;ws=g.x(ws);for(qu=ws.next();!qu.done;qu=ws.next())if(qu=qu.value,qu.streamsProgress){qu=g.x(qu.streamsProgress);for(var H9=qu.next();!H9.done;H9=
qu.next()){var H=void 0;h3+=Number((H=H9.value.numBytesDownloaded)!=null?H:0)}}JF.downloadedBytes=bh(h3);JF.selectedOfflineMode=m5[I]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";o$.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(JF.offlinePlaybackDisabledReason=o$.offlinePlaybackDisabledReason);return JF});
return Ky.return({offlineVideos:hF,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:t}}})})},Wh8=function(){this.locks=navigator.locks},$F_=function(){try{var b=g.$_("ytglobal.locks_");
if(b)return b;var L;if(L=navigator){var q=navigator;L="locks"in q&&!!q.locks}if(L)return g.wW.localStorage&&g.wW.localStorage.getItem("noop"),b=new Wh8,g.Iq("ytglobal.locks_",b),b}catch(V){}},J0=function(){},HHF=function(){},zh_=function(b){if(b.includes(":"))throw Error("Invalid user cache name: "+b);
return b+":"+g.fw("CacheStorage get")},gn8=function(){return g.P(function(b){if(UH!==void 0)return b.return(UH);
UH=new Promise(function(L){var q;return g.P(function(V){switch(V.U){case 1:return g.Rq(V,2),g.u(V,bX.open("test-only"),4);case 4:return g.u(V,bX.delete("test-only"),5);case 5:g.h_(V,3);break;case 2:if(q=g.dW(V),q instanceof Error&&q.name==="SecurityError")return L(!1),V.return();case 3:L("caches"in window),g.GF(V)}})});
return b.return(UH)})},iH_=function(){return g.P(function(b){if(b.U==1)return g.u(b,gn8(),2);
if(!b.L)return b.return(void 0);Kh_||(Kh_=new HHF);return b.return(Kh_)})},L9=function(b,L,q){g.vF(new g.dU("Woffle: "+b,q?{cotn:q}:""));
L instanceof Error&&g.vF(L)},vnb=function(b){var L;
return g.P(function(q){if(q.U==1)return g.u(q,Ipq(b),2);L=q.L;g.pB("offlineStateSnapshot",L);g.GF(q)})},qA=function(b){g.l.call(this);
var L=this;this.api=b;this.l$={Npc:function(){return L.U},
dlx:function(){return L.L}};
typeof g.wW.BroadcastChannel!=="undefined"&&(this.U=new g.wW.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.fw()),this.U.onmessage=this.B.bind(this),this.L=new g.wW.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.fw()),this.L.onmessage=this.j.bind(this))},VN=function(b,L){b.api.vx("onOfflineOperationFailure",L);
var q;(q=b.U)==null||q.postMessage(L)},xFq=function(b,L,q){var V=this;
this.V=b;this.Uo=L;this.visibility=q;this.X=this.Y=this.J=this.B=this.U=!1;this.j=new g.Xw(function(){V.Rq()});
this.l$={ea:function(){return V.L},
Rq:function(){V.Rq()},
RfD:function(){return V.j}};
this.visibility.subscribe("visibilitystatechange",function(){V.Fu()})},tpF=function(b){if(!b.B&&!b.U){var L=$F_();
if(L){b.B=!0;var q=g.fw("OfflineLockManager");L.request("woffle_orchestration_leader:"+q,{},function(){var V,Q;return g.P(function(G){switch(G.U){case 1:return g.Rq(G,2),b.L=new g.Oe,b.U=!0,b.B=!1,g.u(G,b.V(),4);case 4:return g.u(G,b.L.promise,5);case 5:g.h_(G,0);break;case 2:V=g.dW(G),b.Rq(),V instanceof Error&&(Q=V,Q.args=[{name:"WoLockManagerError",nY:V.name}],g.KB(Q)),g.GF(G)}})})}}},apq=function(b){b.U&&(b.X=!0,QN(b))},rdW=function(b,L){b.U&&(b.J=L,QN(b))},DFq=function(b,L){b.U&&(b.Y=L,QN(b))},
QN=function(b){b.Y&&b.J&&b.X&&b.visibility.isBackground()?g.fI(b.j,6E4):b.j.stop()},GT=function(b){var L;
b.offlineDeleteReason=(L=b.offlineDeleteReason)!=null?L:"OFFLINE_DELETE_REASON_UNKNOWN";var q;b.offlineModeType=(q=b.offlineModeType)!=null?q:"OFFLINE_NOW";g.pB("offlineDeleteEvent",b)},RT=function(b,L){var q=L.videoId;
var V=L.Ef;L=L.offlineModeType;b.encryptedVideoId=q;b.cotn=V==null?void 0:V.cotn;b.offlineabilityFormatType=V==null?void 0:V.maximumDownloadQuality;var Q;b.isRefresh=(Q=V==null?void 0:V.isRefresh)!=null?Q:!1;var G;b.softErrorCount=(G=V==null?void 0:V.transferRetryCount)!=null?G:0;b.offlineModeType=L!=null?L:"OFFLINE_NOW";(b.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&b.statusType==="UNKNOWN_STATUS_TYPE"||!b.transferStatusType&&!b.statusType)&&g.vF(Error("Woffle unknown transfer status"));
g.pB("offlineTransferStatusChanged",b)},jQF=function(b){RT({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},b)},ufb=function(b,L,q,V){V={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!V};L&&q&&(L=Math.floor(L/1024).toFixed(),q=Math.floor(q/1024).toFixed(),V.alreadyDownloadedKbytes=L,V.totalFetchedKbytes=L,V.totalContentKbytes=q);RT(V,b)},cdq=function(b){RT({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},b)},PVT=function(b){RT({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},b)},nnW=function(b){switch(b){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
NA=function(b){var L,q,V;
return((V=(L=b.actionMetadata)==null?void 0:(q=L.retryScheduleIntervalsInSeconds)==null?void 0:q.length)!=null?V:0)>0},oT=function(b){return b.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!b.entityKey},hV=function(b){return b.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!b.entityKey},dK=function(b){return b.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!b.entityKey},kuq=function(b){return b.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!b.entityKey},
O8=function(b,L,q,V,Q){Q=Q===void 0?!1:Q;
var G,R,h,d,O,B;return g.P(function(E){if(E.U==1)return G=g.A2(b,L),R=g.A2(b,"downloadStatusEntity"),g.u(E,CZ(q,{mode:"readonly",qo:!0},function(F){return g.IX.all([cX(F,G,L),cX(F,R,"downloadStatusEntity")])}),2);
h=E.L;d=h.length?h[0]:void 0;if(!d)return E.F8(0);O=lp_;if(B=h.length>1?h[1]:void 0){if(B.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!Q)return E.return();B.downloadState=V}else B={key:R,downloadState:V};g.DQ(d,O,B);return g.u(E,CZ(q,{mode:"readwrite",qo:!0},function(F){return g.IX.all([kU(F,d,L),kU(F,B,"downloadStatusEntity")])}),0)})},BR=function(b,L){return b.actionType===L.actionType&&b.entityKey===L.entityKey},E8=function(b,L){if(b&&b.transferState!=="TRANSFER_STATE_COMPLETE"&&b.transferState!==
"TRANSFER_STATE_FAILED"){var q=g.lB(b.key).entityId;
RT({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:q,Ef:b,offlineModeType:L})}},FO=function(b){if(!b||!b.thumbnails)return[];
var L=[];b=g.x(b.thumbnails);for(var q=b.next();!q.done;q=b.next())q=q.value,q.url&&L.push(q.url);return L},AdR=function(b,L,q){q=q===void 0?[]:q;
var V,Q,G,R,h,d,O,B,E,F,p,M,y;return g.P(function(S){if(S.U==1)return q.length?g.u(S,Xy(b,L),2):S.return([]);V=S.L;Q=new Set;G=g.x(V);for(R=G.next();!R.done;R=G.next())if(h=R.value,d=h.id||h.key)O=g.lB(d).entityId,Q.add(O);B=[];E=g.x(q);for(F=E.next();!F.done;F=E.next())p=F.value,M=p.offlineVideoData,y=void 0,((y=M)==null?0:y.videoId)&&!Q.has(M.videoId)&&B.push(p);return S.return(B)})},Ywu=function(b,L,q){return new g.QY(b,{cotn:L,
raw_player_response:q,download_media:!0,start:Infinity,disable_watch_next:!0})},CV8=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},p9=function(b,L,q,V,Q,G,R,h,d,O,B){this.entityType=b;
this.actionId=L;this.action=q;this.parentActionId=V;this.rootActionId=Q===void 0?L:Q;this.childActionIds=G;this.prereqActionId=R;this.postreqActionIds=h;this.hasChildActionFailed=O;this.retryScheduleIndex=0;this.U=B||Date.now();this.retryScheduleIndex=d||0},MA=function(b){if(!b.key)throw Error("Entity key is required.");
if(!b.actionProto)throw Error("OfflineOrchestrationAction is required.");var L=g.lB(b.key),q=g.lB(b.actionProto.entityKey);return new p9(q.entityType,L.entityId,b.actionProto,b.parentActionId,b.rootActionId,b.childActionIds,b.prereqActionId,b.postreqActionIds,b.retryScheduleIndex,b.hasChildActionFailed,Number(b.enqueueTimeSec)*1E3)},e4=function(b){return{key:g.A2(b.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:b.action,parentActionId:b.parentActionId,rootActionId:b.rootActionId,childActionIds:b.childActionIds,prereqActionId:b.prereqActionId,postreqActionIds:b.postreqActionIds,retryScheduleIndex:b.retryScheduleIndex,hasChildActionFailed:b.hasChildActionFailed,enqueueTimeSec:(b.U/1E3).toFixed()}},mFW=function(){var b;
return g.P(function(L){return L.U==1?g.u(L,iH_(),2):(b=L.L)?L.return(b.delete("yt-player-local-img")):L.return(!0)})},TT=function(b){var L,q;
return g.P(function(V){if(V.U==1)return g.u(V,iH_(),2);if(V.U!=3){L=V.L;if(!L)throw Error("Cache API not supported");return b.length?g.u(V,L.open("yt-player-local-img"),3):V.return()}q=V.L;return g.u(V,Promise.all(b.map(function(Q){return q.delete(Q)})),0)})},Z9=function(b){var L,q;
return g.P(function(V){if(V.U==1)return g.u(V,iH_(),2);if(V.U!=3){L=V.L;if(!L)throw Error("Cache API not supported");return b.length?g.u(V,L.open("yt-player-local-img"),3):V.return()}q=V.L;return g.u(V,q.addAll(b),0)})},yN=function(b,L,q,V,Q){var G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT;
return g.P(function(v8){switch(v8.U){case 1:return G=g.A2(b,"mainVideoEntity"),R=g.A2(b,"ytMainChannelEntity"),h=g.A2(b,"transfer"),d=g.A2(b,"videoDownloadContextEntity"),g.u(v8,CZ(L,{mode:"readonly",qo:!0},function(z){return g.IX.all([cX(z,G,"mainVideoEntity"),cX(z,R,"ytMainChannelEntity"),cX(z,h,"transfer"),cX(z,d,"videoDownloadContextEntity"),PX(z,"ytMainChannelEntity"),PX(z,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=v8.L;B=g.x(O);E=B.next().value;F=B.next().value;p=B.next().value;M=B.next().value;y=B.next().value;S=B.next().value;v=E;K=F;t=p;r=M;k=y;n=S;if(!v&&!K){v8.F8(3);break}G$=v?FO(v.thumbnail):[];if(!K){L3=[];v8.F8(4);break}return g.u(v8,sQb(K,k),5);case 5:L3=v8.L;case 4:return VJ=L3,g.u(v8,TT(G$.concat(VJ)),3);case 3:oY=[];Eo=g.A2(b,"downloadStatusEntity");qT=g.x(n);for(S5=qT.next();!S5.done;S5=qT.next())f3=S5.value,Nu=g.lB(f3.key).entityId,PJ=MA(f3),X2=g.lB(PJ.action.entityKey).entityId,Nu!==
b&&X2!==b||BR(q,f3.actionProto)||oY.push(f3.key);return g.u(v8,CZ(L,{mode:"readwrite",qo:!0},function(z){var UT=oY.map(function(Cy){return lP(z,Cy)});
UT.push(lP(z,G,{VY:!0}));UT.push(lP(z,Eo,{VY:!0}));return g.IX.all(UT)}),7);
case 7:sT=(Do=r)==null?void 0:Do.offlineModeType,Q&&(GT(Q),Q.offlineModeType&&(sT=Q.offlineModeType)),E8(t,sT),VN(V,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.GF(v8)}})},JdF=function(b,L,q,V){var Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT,v8,z,UT,Cy,hF,Ky,I,bh,ws,o$,m5,h3,JF,qu,H9,H,w,W;
return g.P(function(D){switch(D.U){case 1:return Q=g.A2(b,"mainPlaylistEntity"),G=g.A2(b,"ytMainChannelEntity"),g.u(D,CZ(L,{mode:"readonly",qo:!0},function(m){return g.IX.all([cX(m,Q,"mainPlaylistEntity"),cX(m,G,"ytMainChannelEntity"),PX(m,"mainPlaylistEntity"),PX(m,"mainDownloadsListEntity"),PX(m,"ytMainChannelEntity"),PX(m,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=D.L;h=g.x(R);d=h.next().value;O=h.next().value;B=h.next().value;E=h.next().value;F=h.next().value;p=h.next().value;M=d;y=O;S=B;v=E;K=F;t=p;if(!M&&!y){D.F8(3);break}r=M?XP_(M):[];if(!y){k=[];D.F8(4);break}return g.u(D,sQb(y,K),5);case 5:k=D.L;case 4:return n=k,g.u(D,TT(r.concat(n)),3);case 3:G$=[];L3=new Map;if(!M){D.F8(7);break}return g.u(D,fp_(M,S,v),8);case 8:G$=D.L;VJ=g.x(G$);for(oY=VJ.next();!oY.done;oY=VJ.next())Eo=oY.value,L3.set(Eo,{videoId:Eo,playlistId:b,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.u(D,CZ(L,{mode:"readonly",qo:!0},function(m){return g.IX.all([PX(m,"transfer"),PX(m,"videoDownloadContextEntity")])}),9);
case 9:qT=D.L;S5=g.x(qT);f3=S5.next().value;Nu=S5.next().value;PJ=f3;X2=Nu;Do=g.x(PJ);for(sT=Do.next();!sT.done;sT=Do.next())v8=sT.value,z=g.lB(v8.key).entityId,(UT=L3.get(z))&&v8&&(UT.cotn=v8.cotn);Cy=g.x(X2);for(hF=Cy.next();!hF.done;hF=Cy.next())Ky=hF.value,I=g.lB(Ky.key).entityId,(bh=L3.get(I))&&Ky&&(bh.offlineModeType=Ky.offlineModeType);case 7:ws=[];o$=g.x(t);for(m5=o$.next();!m5.done;m5=o$.next())h3=m5.value,JF=g.lB(h3.key).entityId,qu=MA(h3),JF!==b&&qu.rootActionId!==b||BR(q,h3.actionProto)||
ws.push(h3.key);H9=g.A2(b,"mainPlaylistEntity");return g.u(D,CZ(L,{mode:"readwrite",qo:!0},function(m){var NT=ws.map(function(f){return lP(m,f)});
NT.push(lP(m,H9,{VY:!0}));return g.IX.all(NT)}),10);
case 10:if(!M){D.F8(0);break}G$.reverse();if(!G$){D.F8(0);break}H=g.x(G$);w=H.next();case 13:if(w.done){D.F8(0);break}W=w.value;return g.u(D,yN(W,L,q,V,L3.get(W)),14);case 14:w=H.next(),D.F8(13)}})},bms=function(b,L,q,V){var Q,G,R,h,d,O,B,E,F;
return g.P(function(p){if(p.U==1)return Q=g.A2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),G=new Map,g.u(p,CZ(b,{mode:"readwrite",qo:!0},function(M){var y=PX(M,"transfer"),S=PX(M,"offlineOrchestrationActionWrapperEntity"),v=PX(M,"videoDownloadContextEntity"),K=cX(M,Q,"mainDownloadsListEntity");return g.IX.all([y,S,v,K]).then(function(t){t=g.x(t);var r=t.next().value;var k=t.next().value;var n=t.next().value;var G$=t.next().value;t=UFs.map(function(VJ){return miW(M,VJ)});
k=g.x(k);for(var L3=k.next();!L3.done;L3=k.next())L3=L3.value,BR(L,L3.actionProto)||t.push(lP(M,L3.key,{VY:!0}));G$&&(G$.downloads=[],t.push(kU(M,G$,"mainDownloadsListEntity")));if(n)for(n=g.x(n),G$=n.next();!G$.done;G$=n.next())G$=G$.value,k=g.lB(G$.key).entityId,k=g.A2(k,"transfer"),G.set(k,G$.offlineModeType);return g.IX.all(t).then(function(){return r})})}),2);
R=p.L;h=g.x(R);for(d=h.next();!d.done;d=h.next())O=d.value,E8(O,G.get(O.key)),B=g.lB(O.key).entityId,E={videoId:B,offlineDeleteReason:V,cotn:O.cotn,offlineModeType:G.get(O.key)},GT(E),F=g.A2(B,"mainVideoEntity"),VN(q,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.u(p,mFW(),0)})},XP_=function(b,L){var q=[];
if(b.thumbnailStyleData){b=g.x(b.thumbnailStyleData);for(var V=b.next();!V.done;V=b.next()){var Q=void 0,G=void 0,R=void 0;q=q.concat(FO((Q=V.value)==null?void 0:(G=Q.value)==null?void 0:(R=G.collageThumbnail)==null?void 0:R.coverThumbnail))}}L=FO(L);return q.concat(L)},fp_=function(b,L,q){var V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ;
return g.P(function(oY){V=[];Q=new Set;if(q.length)for(G=g.x(q),R=G.next();!R.done;R=G.next())if(h=R.value,d=void 0,(d=h.downloads)==null?0:d.length)for(O=g.x(h.downloads),B=O.next();!B.done;B=O.next())E=B.value,E.videoItem&&(F=g.lB(E.videoItem).entityId,Q.add(F));if(b.videos){p=g.x(b.videos);for(M=p.next();!M.done;M=p.next())y=M.value,S=JSON.parse(g.lB(y).entityId),S.videoId&&!Q.has(S.videoId)&&V.push(S.videoId);v=g.x(L);for(K=v.next();!K.done;K=v.next())if(t=K.value,t.key!==b.key&&(r=t.videos))for(k=
g.x(r),n=k.next();!n.done;n=k.next())G$=n.value,L3=JSON.parse(g.lB(G$).entityId),L3.videoId&&(VJ=V.indexOf(L3.videoId),VJ!==-1&&V.splice(VJ,1))}return oY.return(V)})},sQb=function(b,L){var q,V,Q,G,R,h,d,O;
return g.P(function(B){q=FO(b.avatar);V=g.x(L);for(Q=V.next();!Q.done;Q=V.next())if(G=Q.value,G.id!==b.id)for(R=g.x(FO(G.avatar)),h=R.next();!h.done;h=R.next())d=h.value,O=q.indexOf(d),O!==-1&&q.splice(O,1);return B.return(q)})},LOR=function(b){var L;
return g.P(function(q){L=g.T(b.frameworkUpdates,wK);return b.frameworkUpdates&&L?g.u(q,NvW(L),0):q.return()})},Vmy=function(b){var L;
if((L=b.onResponseReceivedActions)!=null&&L.length){var q;b=(q=g.T(g.T(b.onResponseReceivedActions[0],qiq),g.qTQ))==null?void 0:q.actions;if(b!=null&&b.length)return b}},QPQ=function(b){var L,q,V;
return g.P(function(Q){if(Q.U==1)return b?g.u(Q,sH(b,g.xv,"mainDownloadsListEntity"),2):Q.return([]);L=Q.L;return((q=L)==null?0:(V=q.downloads)==null?0:V.length)?Q.return(L.downloads.map(function(G){var R;return(R=G.videoItem)!=null?R:""})):Q.return([])})},RKT=function(b,L){var q;
return g.P(function(V){return V.U==1?g.u(V,GST(b,L),2):(q=V.L)?g.u(V,CZ(b,{mode:"readwrite",qo:!0},function(Q){var G=[kU(Q,q.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];q.mainDownloadsListEntity&&G.push(kU(Q,q.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.IX.all(G)}),0):V.F8(0)})},GST=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t;
return g.P(function(r){if(r.U==1)return q=g.A2("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.A2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.u(r,CZ(b,{mode:"readonly",qo:!0},function(k){return g.IX.all([cX(k,q,"mainDownloadsLibraryEntity"),cX(k,V,"mainDownloadsListEntity")])}),2);
Q=r.L;G=g.x(Q);R=G.next().value;h=G.next().value;d=R;O=h;d||(d={id:q});B=g.x(L);for(E=B.next();!E.done;E=B.next())if(F=E.value,F===g.xv){if(d.smartDownloadsList)return r.return();d.smartDownloadsList=F}else if(p=g.lB(F).entityType,M={},p==="mainPlaylistEntity"?M.playlistItem=F:p==="mainVideoEntity"&&(M.videoItem=F),!g.KJ(M)){y=void 0;if((y=O)==null?0:y.downloads){S=!1;v=g.x(O.downloads);for(K=v.next();!K.done;K=v.next())if(t=K.value,t.playlistItem===F||t.videoItem===F){S=!0;break}S||O.downloads.push(M)}else O=
{id:V,downloads:[M]};d.downloadsList=V}return r.return({mainDownloadsLibraryEntity:d,mainDownloadsListEntity:O})})},NXs=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S;
return g.P(function(v){if(v.U==1)return q=g.A2("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.A2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.u(v,CZ(b,{mode:"readonly",qo:!0},function(K){return g.IX.all([cX(K,q,"mainDownloadsLibraryEntity"),cX(K,V,"mainDownloadsListEntity"),cX(K,g.xv,"mainDownloadsListEntity")])}),2);
Q=v.L;G=g.x(Q);R=G.next().value;h=G.next().value;d=G.next().value;O=R;B=h;E=d;if(!O)return v.F8(0);if(L===g.xv&&((F=E)==null?0:F.downloads))E.downloads=[];else if((p=B)==null?0:p.downloads)for(M=g.lB(L).entityType,y=0;y<B.downloads.length;y++)if(S=B.downloads[y],M==="mainVideoEntity"&&S.videoItem===L){B.downloads.splice(y,1);break}else if(M==="mainPlaylistEntity"&&S.playlistItem===L){B.downloads.splice(y,1);break}return g.u(v,CZ(b,{mode:"readwrite",qo:!0},function(K){var t=[kU(K,O,"mainDownloadsLibraryEntity")];
B&&t.push(kU(K,B,"mainDownloadsListEntity"));E&&t.push(kU(K,E,"mainDownloadsListEntity"));return g.IX.all(t)}),0)})},S4=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F;
return g.P(function(p){if(p.U==1)return q=g.A2(L,"transfer"),V=g.A2(L,"videoDownloadContextEntity"),g.u(p,CZ(b,{mode:"readonly",qo:!0},function(M){return g.IX.all([cX(M,q,"transfer"),cX(M,V,"videoDownloadContextEntity")])}),2);
Q=p.L;G=g.x(Q);R=G.next().value;h=G.next().value;d=R;O=h;F={videoId:L,cotn:(B=d)==null?void 0:B.cotn,offlineModeType:(E=O)==null?void 0:E.offlineModeType};return p.return(F)})},IT=function(b,L,q,V,Q){var G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3;
return g.P(function(VJ){switch(VJ.U){case 1:return G=g.A2(b,"musicTrack"),R=g.A2(b,"transfer"),g.u(VJ,CZ(L,{mode:"readonly",qo:!0},function(oY){return g.IX.all([cX(oY,G,"musicTrack"),cX(oY,R,"transfer"),PX(oY,"musicTrack"),PX(oY,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=VJ.L;d=g.x(h);O=d.next().value;B=d.next().value;E=d.next().value;F=d.next().value;p=O;M=B;y=E;S=F;if(!p){VJ.F8(3);break}return g.u(VJ,os_(p,y),4);case 4:return v=VJ.L,g.u(VJ,TT(v),3);case 3:K=[];t=g.x(S);for(r=t.next();!r.done;r=t.next())k=r.value,n=g.lB(k.key).entityId,G$=MA(k),L3=g.lB(G$.action.entityKey).entityId,n!==b&&L3!==b||BR(q,k.actionProto)||K.push(k.key);return g.u(VJ,CZ(L,{mode:"readwrite",qo:!0},function(oY){var Eo=K.map(function(qT){return lP(oY,qT)});
Eo.push(lP(oY,G,{VY:!0}));return g.IX.all(Eo)}),6);
case 6:E8(M),Q&&GT(Q),VN(V,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.GF(VJ)}})},WR=function(b,L,q,V,Q){var G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT,v8,z,UT,Cy,hF;
return g.P(function(Ky){switch(Ky.U){case 1:return G=g.A2(b,L),R=g.A2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.u(Ky,CZ(q,{mode:"readonly",qo:!0},function(I){return g.IX.all([cX(I,G,L),cX(I,R,"musicDownloadsLibraryEntity"),PX(I,L),PX(I,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=Ky.L;d=g.x(h);O=d.next().value;B=d.next().value;E=d.next().value;F=d.next().value;p=O;M=B;y=E;S=F;if(!p){Ky.F8(3);break}return g.u(Ky,os_(p,y),4);case 4:return v=Ky.L,g.u(Ky,TT(v),3);case 3:K=[];t=new Map;if(!p){Ky.F8(6);break}return g.u(Ky,hKW(p,y,M),7);case 7:K=Ky.L;r=g.x(K);for(k=r.next();!k.done;k=r.next())n=k.value,G$=g.lB(n).entityId,t.set(G$,{videoId:G$,playlistId:b,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.u(Ky,Xy(q,"transfer"),8);case 8:for(L3=Ky.L,
VJ=g.x(L3),oY=VJ.next();!oY.done;oY=VJ.next())Eo=oY.value,qT=g.lB(Eo.key).entityId,(S5=t.get(qT))&&Eo&&(S5.cotn=Eo.cotn);case 6:f3=[];Nu=g.x(S);for(PJ=Nu.next();!PJ.done;PJ=Nu.next())X2=PJ.value,Do=g.lB(X2.key).entityId,sT=MA(X2),Do!==b&&sT.rootActionId!==b||BR(V,X2.actionProto)||f3.push(X2.key);v8=g.A2(b,L);return g.u(Ky,CZ(q,{mode:"readwrite",qo:!0},function(I){var bh=f3.map(function(ws){return lP(I,ws)});
bh.push(lP(I,v8,{VY:!0}));return g.IX.all(bh)}),9);
case 9:if(!p){Ky.F8(0);break}K.reverse();if(!K.length){Ky.F8(0);break}z=g.x(K);UT=z.next();case 12:if(UT.done){Ky.F8(0);break}Cy=UT.value;hF=g.lB(Cy).entityId;if(!hF){Ky.F8(13);break}return g.u(Ky,IT(hF,q,V,Q,t.get(hF)),13);case 13:UT=z.next(),Ky.F8(12)}})},$x=function(b,L,q){var V,Q,G,R,h,d,O;
return g.P(function(B){if(B.U==1)return g.u(B,CZ(b,{mode:"readwrite",qo:!0},function(E){var F=PX(E,"transfer"),p=PX(E,"offlineOrchestrationActionWrapperEntity");return g.IX.all([F,p]).then(function(M){M=g.x(M);var y=M.next().value;var S=M.next().value;M=dQ8.map(function(r){return miW(E,r)});
S=g.x(S);for(var v=S.next();!v.done;v=S.next()){v=v.value;var K=g.lB(v.actionProto.entityKey).entityType==="musicTrack",t=v.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";BR(L,v.actionProto)||K&&(!K||t)||M.push(lP(E,v.key,{VY:!0}))}return g.IX.all(M).then(function(){return y})})}),2);
V=B.L;Q=g.x(V);for(G=Q.next();!G.done;G=Q.next())R=G.value,E8(R),h=g.lB(R.key).entityId,d={videoId:h,offlineDeleteReason:void 0,cotn:R.cotn},GT(d),O=g.A2(h,"musicTrack"),VN(q,{entityKey:O,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.u(B,mFW(),0)})},Om_=function(b){for(var L,q=g.x(b.additionalMetadatas),V=q.next();!V.done;V=q.next())V=V.value,V.offlineMusicVideoData&&(L=V.offlineMusicVideoData);
var Q,G,R,h,d;return{id:g.A2(b.videoId,"musicTrack"),videoId:b.videoId,title:b.title,thumbnailDetails:b.thumbnail,lengthMs:String(Number(b.lengthSeconds)*1E3),albumTitle:(Q=L)==null?void 0:Q.releaseTitle,musicVideoType:(G=L)==null?void 0:G.musicVideoType,contentRating:{explicitType:(R=L)==null?void 0:R.explicitType},artistNames:((h=L)==null?void 0:h.byline)||((d=L)==null?void 0:d.channelName),downloadMetadata:g.A2(b.videoId,"musicTrackDownloadMetadataEntity")}},hKW=function(b,L,q){var V,Q,G,R,h,d,
O,B,E,F,p,M,y,S,v,K,t,r;
return g.P(function(k){V=[];Q=new Set;if((G=q)==null?0:(R=G.downloadedTracks)==null?0:R.length)for(h=g.x(q.downloadedTracks),d=h.next();!d.done;d=h.next())O=d.value,Q.add(O);if(b.tracks){B=g.x(b.tracks);for(E=B.next();!E.done;E=B.next())F=E.value,Q.has(F)||V.push(F);p=g.x(L);for(M=p.next();!M.done;M=p.next())if(y=M.value,y.id!==b.id&&(S=y.tracks))for(v=g.x(S),K=v.next();!K.done;K=v.next())t=K.value,r=V.indexOf(t),r!==-1&&V.splice(r,1)}return k.return(V)})},os_=function(b,L){var q,V,Q,G,R,h,d,O;
return g.P(function(B){q=FO(b.thumbnailDetails);V=g.x(L);for(Q=V.next();!Q.done;Q=V.next())if(G=Q.value,G.id!==b.id)for(R=g.x(FO(G.thumbnailDetails)),h=R.next();!h.done;h=R.next())d=h.value,O=q.indexOf(d),O!==-1&&q.splice(O,1);return B.return(q)})},BXy=function(b,L){var q,V,Q,G,R,h,d,O,B;
return g.P(function(E){if(E.U==1)return q=g.A2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.u(E,sH(b,q,"musicDownloadsLibraryEntity"),2);(V=E.L)||(V={id:q});Q=g.lB(L).entityType;Q==="musicTrack"?(G=V.downloadedTracks)!=null&&G.includes(L)||(V.downloadedTracks=((R=V.downloadedTracks)!=null?R:[]).concat(L)):Q==="musicPlaylist"?(h=V.downloadedPlaylists)!=null&&h.includes(L)||(V.downloadedPlaylists=((d=V.downloadedPlaylists)!=null?d:[]).concat(L)):Q!=="musicAlbumRelease"||(O=V.downloadedAlbumReleases)!=
null&&O.includes(L)||(V.downloadedAlbumReleases=((B=V.downloadedAlbumReleases)!=null?B:[]).concat(L));return g.u(E,mK(b,V,"musicDownloadsLibraryEntity"),0)})},Es8=function(b,L){var q,V,Q,G,R,h,d;
return g.P(function(O){if(O.U==1)return q=g.A2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.u(O,sH(b,q,"musicDownloadsLibraryEntity"),2);V=O.L;if(!V)return O.F8(0);Q=g.lB(L).entityType;Q==="musicTrack"?G=V.downloadedTracks:Q==="musicPlaylist"&&(G=V.downloadedPlaylists);if((R=G)==null?0:R.length)for(h=0;h<G.length;h++)if(d=G[h],d===L){G.splice(h,1);break}return g.u(O,mK(b,V,"musicDownloadsLibraryEntity"),0)})},FOy=function(b){var L=b.videos;
b=[];var q=[];if(L){L=g.x(L);for(var V=L.next();!V.done;V=L.next()){var Q=V.value.offlineVideoData.videoId;V=g.A2(Q,"musicTrack");Q=g.A2(Q,"musicTrackDownloadMetadataEntity");b.push(V);q.push(Q)}}return{Gu:b,Ee:q}},HR=function(b,L,q){L={track:Om_(L)};
q&&(L.playlistId=q);if(b=g.T(b.actionMetadata,pVb))L.maximumDownloadQuality=b.maximumDownloadQuality;return{musicTrackEntityActionMetadata:L}},eKb=function(b){var L,q,V,Q,G,R,h,d;
return g.P(function(O){switch(O.U){case 1:return L=g.Xv(),q=pPw(b),V=g.bG(Mmq),g.Rq(O,2),G={BZ:!0},g.u(O,g.jQ(L,q,V,void 0,G),4);case 4:Q=O.L;g.h_(O,3);break;case 2:R=g.dW(O);if(R instanceof g.Cc)throw h="GetOffline network manager error: "+R.message,L9(h,R),Error(h);L9("GetOffline fetch request error",R);throw Error("GetOffline fetch request error");case 3:d=zT(Q);if(!Q)throw L9("Network request failed"),Error("Network request failed");if(d!==void 0)gK(d);else if(!Q.videos||!Q.videos.length)throw L9("No data"),
Error("No data");return O.return(Q.videos.map(function(B){return B.offlineVideoData}))}})},TXb=function(b){var L,q,V,Q,G,R,h,d;
return g.P(function(O){switch(O.U){case 1:return L=g.Xv(),q=Mpq(b),V=g.bG(Mmq),g.Rq(O,2),G={BZ:!0},g.u(O,g.jQ(L,q,V,void 0,G),4);case 4:Q=O.L;g.h_(O,3);break;case 2:R=g.dW(O);if(R instanceof g.Cc)throw h="GetOffline network manager error for playlist: "+R.message,L9(h,R),Error(h);L9("GetOffline fetch request error for playlist",R);throw Error("GetOffline fetch request error for playlist");case 3:d=zT(Q);if(!Q)throw L9("Network request failed for playlist"),Error("Network request failed for playlist");
if(d!==void 0)gK(d,"playlist");else if(!Q.playlists||!Q.playlists.length)throw L9("No data for playlist"),Error("No data for playlist");return O.return(Q.playlists.map(function(B){return B.offlinePlaylistData}))}})},yoy=function(b,L,q,V){var Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2;
return g.P(function(Do){switch(Do.U){case 1:return g.u(Do,fZ(),2);case 2:Q=Do.L;if(!Q)return Do.return([]);G=[];if((R=V)==null?0:R.length){G=V;Do.F8(3);break}return g.u(Do,Xy(Q,"mainPlaylistEntity"),4);case 4:G=Do.L;case 3:if(!G.length)return Do.return([]);h=[];d=Date.now()/1E3;O=g.x(G);B=O.next();case 5:if(B.done)return h.length?g.u(Do,Zms(h),10):Do.return([]);E=B.value;if(!E.downloadState){F=void 0;Do.F8(8);break}return g.u(Do,sH(Q,E.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:F=
Do.L;case 8:p=F;M=void 0;S=(y=(M=E)==null?void 0:M.entityMetadata)&&y.nextAutoRefreshIntervalSeconds?Number(y.nextAutoRefreshIntervalSeconds):NaN;v=Number.isNaN(S)?b:S;t=K=void 0;r=((K=p)==null?0:K.lastSyncedTimestampMillis)?Number((t=p)==null?void 0:t.lastSyncedTimestampMillis)/1E3:0;n=k=void 0;G$=((k=p)==null?0:k.addedTimestampMillis)?Number((n=p)==null?void 0:n.addedTimestampMillis)/1E3:0;if(q||!y||r+v<=d){L3=[];VJ=void 0;if((VJ=E.videos)==null?0:VJ.length)for(oY=g.x(E.videos),Eo=oY.next();!Eo.done;Eo=
oY.next())qT=Eo.value,S5=JSON.parse(g.lB(qT).entityId),S5.videoId&&L3.push(S5.videoId);f3="0";y&&(Nu=void 0,f3=String(Number((Nu=y.offlineLastModifiedTimestampSeconds)!=null?Nu:0).toFixed()));PJ={playlistId:E.playlistId,videoIds:L3,offlineLastModifiedTimestamp:f3,autoSync:L,offlineDateAddedTimestamp:String(G$.toFixed())};h.push(PJ)}B=O.next();Do.F8(5);break;case 10:return X2=Do.L,Do.return(X2)}})},wV8=function(){var b,L,q,V,Q;
return g.P(function(G){if(G.U==1)return g.u(G,fZ(),2);if(G.U!=3)return(b=G.L)?g.u(G,Xy(b,"refresh"),3):G.return(!1);L=G.L;if((q=L[0])==null||!q.refreshTime)return G.return(!1);V=Number(L[0].refreshTime);Q=Date.now()/1E3;return G.return(isFinite(V)&&Q>=V)})},IS_=function(b,L){var q,V,Q;
return g.P(function(G){switch(G.U){case 1:return g.Rq(G,2),g.u(G,Sis(b,L),4);case 4:return V=G.L,g.u(G,LOR(V),5);case 5:q=Vmy(V);g.h_(G,3);break;case 2:Q=g.dW(G),L9("getAndProcessSmartDownloadsResponse request or processing error",Q);case 3:return G.return(q)}})},WOb=function(b,L,q,V){var Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2;
return g.P(function(Do){switch(Do.U){case 1:return g.u(Do,fZ(),2);case 2:Q=Do.L;if(!Q)return Do.return([]);G=[];if((R=V)==null?0:R.length){G=V;Do.F8(3);break}return g.u(Do,Xy(Q,"musicPlaylist"),4);case 4:G=Do.L;case 3:if(!G.length)return Do.return([]);h=[];d=Date.now()/1E3;O=g.x(G);B=O.next();case 5:if(B.done)return h.length?g.u(Do,Zms(h),10):Do.return([]);E=B.value;F=void 0;M=(p=(F=E)==null?void 0:F.entityMetadata)&&p.nextAutoRefreshIntervalSeconds?Number(p.nextAutoRefreshIntervalSeconds):NaN;y=
Number.isNaN(M)?b:M;v=S=0;K="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!E.downloadMetadata){Do.F8(8);break}return g.u(Do,sH(Q,E.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:t=Do.L,k=r=void 0,S=Number((k=(r=t)==null?void 0:r.addedTimestampMillis)!=null?k:"0")/1E3,G$=n=void 0,v=Number((G$=(n=t)==null?void 0:n.lastModifiedTimestampMillis)!=null?G$:"0")/1E3,VJ=L3=void 0,K=(VJ=(L3=t)==null?void 0:L3.syncState)!=null?VJ:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:oY=void 0;if(q||K!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!p||Number((oY=p.lastSyncedTimestampSeconds)!=null?oY:0)+y<=d){Eo=[];qT=void 0;if((qT=E.tracks)==null?0:qT.length)for(S5=g.x(E.tracks),f3=S5.next();!f3.done;f3=S5.next())Nu=f3.value,Eo.push(g.lB(Nu).entityId);PJ={playlistId:E.playlistId,videoIds:Eo,offlineLastModifiedTimestamp:String(v.toFixed()),autoSync:L,offlineDateAddedTimestamp:String(S.toFixed())};h.push(PJ)}B=O.next();Do.F8(5);break;case 10:return X2=Do.L,Do.return(X2)}})},Sis=function(b,L){var q,V,Q,G,R,h,d,O,B,E;
return g.P(function(F){switch(F.U){case 1:return q=g.Xv(),g.u(F,fZ(),2);case 2:V=F.L;if(!V){F.F8(3);break}return g.u(F,Ipq(V),4);case 4:Q=F.L;case 3:var p=Q;G={context:g.fd(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:b},offlineClientState:p,clientStateRequestData:{preferredFormatType:L}}}};R=g.bG($Qq);g.Rq(F,5);d={BZ:!0};return g.u(F,g.jQ(q,G,R,void 0,d),7);case 7:h=F.L;g.h_(F,6);break;case 5:O=g.dW(F);if(O instanceof g.Cc)throw B=
"DPS network manager error for smart downloads: "+O.message,L9(B,O),Error(B);L9("DPS fetch request error for smart downloads",O);throw Error("DPS fetch request error for smart downloads");case 6:E=zT(h);if(h)E!==void 0&&gK(E,"smart downloads");else throw L9("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return F.return(h)}})},zKF=function(b,L){var q,V,Q,G,R,h,d,O;
return g.P(function(B){switch(B.U){case 1:return q=g.Xv(),V={context:g.fd(),videoPlaybackPositionEntities:b,lastSyncTimestampUsec:L},Q=g.bG(HmQ),g.Rq(B,2),R={BZ:!0},g.u(B,g.jQ(q,V,Q,void 0,R),4);case 4:G=B.L;g.h_(B,3);break;case 2:h=g.dW(B);if(h instanceof g.Cc)throw d="VPPS network manager error: "+h.message,L9(d,h),Error(d);L9("VPPS fetch request error",h);throw Error("VPPS fetch request error");case 3:O=zT(G);if(G)O!==void 0&&gK(O,"position sync");else throw L9("Network request failed for position sync"),
Error("Network request failed for position sync");return B.return(G)}})},KO8=function(b,L,q){var V,Q,G,R,h,d,O,B;
return g.P(function(E){switch(E.U){case 1:V=g.Xv();var F=q.refreshData,p=q.isEnqueuedForExpiredStreamUrlRefetch,M=q.XS,y=q.offlineSourceData,S=q.mediaCapabilities,v={entityKey:b};F&&(v.refreshData=F);p&&(v.isExpiredStreamUrlRefetch=p);M&&(v.downloadParameters=M);y&&(v.offlineSourceData=y);F={context:g.BW(L),signatureTimestamp:20410,videos:[v]};S&&(F.mediaCapabilities=S);Q=F;G=g.bG(gsQ);g.Rq(E,2);h={BZ:!0};return g.u(E,g.jQ(V,Q,G,void 0,h),4);case 4:R=E.L;g.h_(E,3);break;case 2:d=g.dW(E);if(d instanceof
g.Cc)throw O="GetPDE network manager error: "+d.message,L9(O,d),Error(O);L9("GetPDE fetch request error",d);throw Error("GetPDE fetch request error");case 3:B=zT(R);if(R)B!==void 0&&gK(B,"PDE");else throw L9("Network request failed for PDE"),Error("Network request failed for PDE");return E.return(R)}})},zT=function(b){var L;
return(L=b.errorMetadata)==null?void 0:L.status},gK=function(b,L){L=L?" for "+L:"";
if(b===0)throw b="Empty response body"+L,L9(b),Error(b);b="Response with error"+L;L9(b);throw Error(b);},Zms=function(b){var L,q,V,Q,G,R,h,d;
return g.P(function(O){switch(O.U){case 1:return L=g.Xv(),q=ehu(b),V=g.bG(imW),g.Rq(O,2),G={BZ:!0},g.u(O,g.jQ(L,q,V,void 0,G),4);case 4:Q=O.L;g.h_(O,3);break;case 2:R=g.dW(O);if(R instanceof g.Cc)throw h="offlinePlaylistSyncCheck network manager error: "+R.message,L9(h,R),Error(h);L9("offlinePlaylistSyncCheck fetch request error",R);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:d=zT(Q);if(!Q)throw L9("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(d!==void 0)gK(d,"playlist sync");else if(!Q.offlinePlaylistSyncCheckDatas||!Q.offlinePlaylistSyncCheckDatas.length)throw L9("No data for playlist sync"),Error("No data for playlist sync");return O.return(Q.offlinePlaylistSyncCheckDatas.map(function(B){return B.offlinePlaylistSyncCheckData}))}})},K9=function(b){this.U=b},vsw=function(b,L){var q,V,Q,G,R,h;
return g.P(function(d){switch(d.U){case 1:q=new Map,V=g.x(L),Q=V.next();case 2:if(Q.done){d.F8(4);break}G=Q.value;R=q;h=R.set;return g.u(d,b.L(G),5);case 5:h.call(R,G,d.L);Q=V.next();d.F8(2);break;case 4:return d.return(q)}})},iX=function(b,L,q,V,Q,G){L=g.A2(L,q);
V=Object.assign({},G,{priority:V,retryScheduleIntervalsInSeconds:Q});return{actionType:b,entityKey:L,actionMetadata:V}},vR=function(b,L,q,V,Q,G){this.status=b;
this.U=L;this.j=q;this.L=V;this.B=Q;this.downloadState=G},xQT=function(b,L,q){this.U=b;
this.N=L;this.B=q},roW=function(b,L){var q,V,Q,G,R,h,d,O,B;
return g.P(function(E){switch(E.U){case 1:return q=L.entityKey,Q=(V=g.T(L.actionMetadata,xx))==null?void 0:V.isEnqueuedForExpiredStreamUrlRefetch,g.Rq(E,2),G=void 0,g.u(E,tmb(b,L),4);case 4:G=E.L;g.Rq(E,5);var F=(F=g.T(L.actionMetadata,xx))?{maximumDownloadQuality:F.maximumDownloadQuality}:void 0;return g.u(E,KO8(q,b.N,{isEnqueuedForExpiredStreamUrlRefetch:Q,XS:F,offlineSourceData:G}),7);case 7:R=E.L;g.h_(E,6,2);break;case 5:return g.dW(E,2),h=NA(L)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",L9("PDE handleAdd error"),E.return(tV(L,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",h,"DOWNLOAD_STATE_FAILED"));case 6:return g.u(E,aSb(b,R,L),8);case 8:return E.return(tV(L,!0,R.orchestrationActions));case 2:return d=g.dW(E),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.M$&&d.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L9("PDE handleAdd error"),E.return(tV(L,!1,void 0,O,B,"DOWNLOAD_STATE_FAILED"))}})},u_y=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ;
return g.P(function(oY){switch(oY.U){case 1:return q=L.entityKey,V=g.lB(q).entityId,g.u(oY,CZ(b.U,{mode:"readonly",qo:!0},function(Eo){var qT=cX(Eo,q,"playbackData"),S5=cX(Eo,g.A2(V,"offlineVideoPolicy"),"offlineVideoPolicy");Eo=cX(Eo,g.A2(V,"transfer"),"transfer");return g.IX.all([qT,S5,Eo])}),2);
case 2:Q=oY.L;G=g.x(Q);R=G.next().value;h=G.next().value;d=G.next().value;O=R;B=h;E=d;if(!O||!B)return oY.return(tV(L,!0));F=[];y=((M=O)==null?0:M.playerResponseJson)?JSON.parse(O.playerResponseJson):null;if(!(E&&y&&b.N.T("html5_refresh_deprecated_downloads"))){oY.F8(3);break}p=DQb(b,y,E);return g.u(oY,jPq(b,E),4);case 4:F=oY.L;case 3:S={lastPlayerResponseTimestampSeconds:O.playerResponseTimestamp,offlineToken:B.offlineToken,formatIds:F};v={};if((K=E)==null?0:K.maximumDownloadQuality)v.maximumDownloadQuality=
E.maximumDownloadQuality;g.Rq(oY,5);t=void 0;return g.u(oY,tmb(b,L),7);case 7:return t=oY.L,g.Rq(oY,8),g.u(oY,KO8(q,b.N,{refreshData:S,XS:v,offlineSourceData:t,mediaCapabilities:p}),10);case 10:r=oY.L;g.h_(oY,9,5);break;case 8:return g.dW(oY,5),k=NA(L)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",L9("PDE handleRefresh error"),oY.return(tV(L,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",k,"DOWNLOAD_STATE_FAILED"));
case 9:return g.u(oY,aSb(b,r,L),11);case 11:return oY.return(tV(L,!0,r.orchestrationActions));case 5:return n=g.dW(oY),G$="PDE handleRefresh error",n instanceof Error&&(G$="PDE handleRefresh error: "+n.message),L3="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",VJ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.M$&&n.type==="QUOTA_EXCEEDED"&&(L3="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",VJ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L9(G$),oY.return(tV(L,
!1,void 0,L3,VJ,"DOWNLOAD_STATE_FAILED"))}})},tmb=function(b,L){var q,V,Q,G;
return g.P(function(R){if(R.U==1)return q=g.lB(L.entityKey).entityId,V=g.A2(q,"videoDownloadContextEntity"),g.u(R,sH(b.U,V,"videoDownloadContextEntity"),2);Q=R.L;return(G=Q)!=null&&G.offlineModeType?R.return({offlineModeType:Q.offlineModeType}):R.return(void 0)})},aSb=function(b,L,q){var V,Q,G,R,h;
return g.P(function(d){if(d.U==1){if(!L.frameworkUpdates||!g.T(L.frameworkUpdates,wK))return d.return();if(!(g.T(L.frameworkUpdates,wK).mutations&&g.T(L.frameworkUpdates,wK).mutations.length>0&&g.T(L.frameworkUpdates,wK).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return d.F8(2);V=g.lB(g.T(L.frameworkUpdates,wK).mutations[0].entityKey).entityId;return g.u(d,S4(b.U,V),3)}if(d.U!=2){Q=d.L;G=g.T(q.actionMetadata,xx);if(h=(R=G)==null?void 0:R.playlistId)Q.playlistId=h;Q.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Nn(b.N)?g.u(d,yN(V,b.U,q,b.B,Q),2):g.DG(b.N)?g.u(d,IT(V,b.U,q,b.B),2):d.F8(2)}return g.u(d,NvW(g.T(L.frameworkUpdates,wK)),0)})},tV=function(b,L,q,V,Q,G){return new vR(L?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",NA(b),q,V,Q,G)},DQb=function(b,L,q){L=Ywu(b.N,q.cotn,L);
q=g.yY(L);return g.dPh(L,q,b.N)},jPq=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F;
return g.P(function(p){if(p.U==1)return q=[],g.u(p,CZ(b.U,{mode:"readonly",qo:!0},function(M){var y=[],S=L.offlineVideoStreams;if(S){S=g.x(S);for(var v=S.next();!v.done;v=S.next())y.push(cX(M,v.value,"offlineVideoStreams"))}return g.IX.all(y)}),2);
if(V=p.L)for(Q=g.x(V),G=Q.next();!G.done;G=Q.next())if(R=G.value,h=void 0,(h=R)==null?0:h.streamsProgress)for(d=R.streamsProgress,O=0;O<d.length;O++)B=d[O],E=JSON.parse(B.formatStreamBytes),F={itag:E.itag,lmt:E.lastModified,xtags:E.xtags},q.push(F);return p.return(q)})},co8=function(b,L){this.U=b;
this.N=L},Pf_=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p;
return g.P(function(M){switch(M.U){case 1:return q=NA(L),g.u(M,Xy(b.U,"videoPlaybackPositionEntity"),2);case 2:V=M.L;if(V.length===0)return M.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.Rq(M,3);return g.u(M,Df.getInstance(),5);case 5:Q=M.L;if(!Q)throw Error("prefStorage is undefined");return g.u(M,Q.get("psi"),6);case 6:return G=M.L,d=(h=(R=G)==null?void 0:R.J8)!=null?h:"0",g.u(M,zKF(V,d),7);case 7:return O=M.L,B={isPaused:O.watchHistoryPaused,J8:O.syncTimestampUsec},g.u(M,Q.set("psi",
B),8);case 8:if(B.isPaused){M.F8(9);break}E=g.T(O.frameworkUpdates,wK);if(!O.frameworkUpdates||!E){M.F8(9);break}return g.u(M,NvW(E),9);case 9:g.h_(M,4);break;case 3:return F=g.dW(M),p="PPE handleRefresh error: "+(F instanceof Error?F.message:"unknown error"),L9(p),M.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},kSw=function(b,L){var q,V,Q,G,R,h,d,O;
return g.P(function(B){switch(B.U){case 1:return q=NA(L),V=g.lB(L.entityKey).entityId,g.Rq(B,2),g.u(B,Df.getInstance(),4);case 4:Q=B.L;if(!Q)throw Error("prefStorage is undefined");return g.u(B,Q.get("psi"),5);case 5:G=B.L;R=g.T(L.actionMetadata,nsF);if(((h=G)==null?void 0:h.isPaused)!==!1||(d=R)==null||!d.lastPlaybackPositionSeconds){B.F8(6);break}O={key:g.A2(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:R.lastPlaybackPositionSeconds};return g.u(B,mK(b.U,O,"videoPlaybackPositionEntity"),
6);case 6:g.h_(B,3);break;case 2:return g.dW(B),B.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},lS_=function(b,L){var q,V,Q;
return g.P(function(G){switch(G.U){case 1:q=NA(L);g.Rq(G,2);V=g.lB(L.entityKey).entityId;if(V==="!*$_ALL_ENTITIES_!*$")return g.u(G,qwy(b.U),5);Q=g.A2(V,"videoPlaybackPositionEntity");return g.u(G,Lhy(b.U,Q),5);case 5:g.h_(G,3);break;case 2:return g.dW(G),G.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},Aoy=function(b,L){this.api=b;
this.U=L;this.logger=new g.wu("woffle");this.L=!1;this.l$={KD:this.KD}},Yiw=function(b){return g.P(function(L){return L.return(Fhu(b))})},CfW=function(b){var L;
return g.P(function(q){if(q.U==1)return g.u(q,g.yx2(b),2);L=q.L;return q.return(L.filter(function(V){return!!V.url}).map(function(V){return V.url}))})},aT=function(b,L){var q=g.lL(L);
if(q===1||q===0)return Promise.resolve();(q=mQQ(b,L))&&q.stopVideo();b.B=0;return Yiw(L)},rK=function(b,L,q,V){q=q===void 0?!1:q;
V=V===void 0?!0:V;L=typeof L==="string"?L:L.videoDetails.videoId;if(g.lL(L)===2){var Q=mQQ(b,L);Q&&Q.stopVideo();g.Au(L,2);b.B=2;q?sP_(b.U):V&&XVW(b.U)}},mQQ=function(b,L){var q;
return((q=b.player)==null?void 0:q.getVideoData().videoId)===L?b.player:null},fSW=function(b,L){this.U=b;
this.N=L},UQu=function(b,L){var q,V;
return g.P(function(Q){switch(Q.U){case 1:return q=NA(L),g.u(Q,sH(b.U,L.entityKey,"transfer"),2);case 2:if(V=Q.L)return Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.Rq(Q,3);return g.u(Q,JoW(b,L),5);case 5:g.h_(Q,4);break;case 3:return g.dW(Q),Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},beW=function(b,L){var q,V;
return g.P(function(Q){switch(Q.U){case 1:return q=NA(L),g.u(Q,sH(b.U,L.entityKey,"transfer"),2);case 2:V=Q.L;if(!V||V.transferState!=="TRANSFER_STATE_COMPLETE")return Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.Rq(Q,3);return g.u(Q,JoW(b,L,!0),5);case 5:g.h_(Q,4);break;case 3:return g.dW(Q),Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},L3q=function(b,L){var q,V,Q,G,R,h,d,O,B,E;
return g.P(function(F){switch(F.U){case 1:return q=NA(L),V=g.lB(L.entityKey).entityId,g.u(F,CZ(b.U,{mode:"readonly",qo:!0},function(p){var M=cX(p,L.entityKey,"transfer");p=cX(p,g.A2(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.IX.all([M,p])}),2);
case 2:Q=F.L;G=g.x(Q);R=G.next().value;h=G.next().value;d=R;O=h;if(!d||d.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return F.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.Rq(F,3);d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.u(F,mK(b.U,d,"transfer"),5);case 5:B=g.lB(d.key).entityId;cdq({videoId:B,Ef:d,offlineModeType:(E=O)==null?void 0:E.offlineModeType});g.h_(F,4);break;case 3:return g.dW(F),F.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return F.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},JoW=function(b,L,q){q=q===void 0?!1:q;
var V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v;return g.P(function(K){switch(K.U){case 1:return V=g.T(L.actionMetadata,qmw),Q=g.lB(L.entityKey).entityId,G=g.A2(Q,"downloadStatusEntity"),g.u(K,CZ(b.U,{mode:"readonly",qo:!0},function(t){var r=cX(t,G,"downloadStatusEntity");t=cX(t,g.A2(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.IX.all([r,t])}),2);
case 2:return R=K.L,h=g.x(R),d=h.next().value,O=h.next().value,B=d,E=O,F="TRANSFER_STATE_TRANSFER_IN_QUEUE",((p=B)==null?void 0:p.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(F="TRANSFER_STATE_PAUSED_BY_USER"),S={key:L.entityKey,transferState:F,cotn:g.eb(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(M=V)==null?void 0:M.maximumDownloadQuality,preferredAudioTrack:(y=V)==null?void 0:y.preferredAudioTrack,transferRetryCount:0,isRefresh:q,hasLoggedFirstStarted:!1},g.u(K,CZ(b.U,
{mode:"readwrite",qo:!0},function(t){var r=[];q&&r.push(lP(t,g.A2(Q,"offlineVideoStreams")));r.push(kU(t,S,"transfer"));return g.IX.all(r)}),3);
case 3:if(!q){K.F8(4);break}return g.u(K,Yiw(Q),4);case 4:jQF({videoId:Q,Ef:S,offlineModeType:(v=E)==null?void 0:v.offlineModeType}),g.GF(K)}})},Qv_=function(b,L,q,V){if(!b.action.entityKey)throw Error("entityKey is missing.");
var Q=g.lB(b.action.entityKey);Q={entityType:Q.qQ,entityId:Q.entityId,offlineOrchestrationActionType:b.action.actionType,orchestrationAction:{orchestrationActionId:b.actionId}};L&&(Q.offlineOrchestrationActionResult=L.status,Q.isRetryable=q?!1:L.U,L.B&&(Q.offlineOrchestrationFailureReason=VOW(L.B,Q.isRetryable)));var G,R;if((G=b.action.actionMetadata)==null?0:(R=G.offlineLoggingData)==null?0:R.offlineModeType)Q.offlineModeType=b.action.actionMetadata.offlineLoggingData.offlineModeType;V&&(Q.additionalOrchestrationActions=
V.map(function(h){return{orchestrationActionId:h.actionId}}));
return Q},VOW=function(b,L){return b!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||L?b==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&L?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":b:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},G2W=function(b,L){var q={offlineOrchestrationContext:Qv_(b)};
L=wPW(L,q);Sws(ydF(),L,b.rootActionId)},RjR=function(b,L,q,V){V=V===void 0?[]:V;
L={offlineOrchestrationContext:Qv_(b,L,q,V)};L=wPW(3,L);Sws(ydF(),L,b.rootActionId)},NFR=function(){this.actions=[]},o1w=function(b,L){L=g.x(L);
for(var q=L.next();!q.done;q=L.next())q=q.value,G2W(q,1),b.actions.push(q);b.actions.sort(b.U)},hjy=function(b,L){if(L)for(var q=0;q<b.actions.length;q++)if(L==="!*$_ALL_ENTITIES_!*$"&&b.actions[q].actionId!==L||L!=="!*$_ALL_ENTITIES_!*$"&&b.actions[q].rootActionId===L&&b.actions[q].actionId!==L)b.actions.splice(q,1),q--},d8_=function(b,L){b=g.x(b.actions);
for(var q=b.next();!q.done;q=b.next())if(q.value.actionId===L)return!0;return!1},D9=function(b,L,q,V,Q){g.l.call(this);
var G=this;this.L=b;this.Dr=L;this.Ls=q;this.Y=V;this.N=Q;this.U=new NFR;this.J=new g.Y$;this.B=new g.Xw(function(){G.retry()});
this.V=NaN;this.X=!1;this.l$={Jvx:function(){return G.U},
Rv:function(){return G.J},
QMP:function(){return G.B},
retry:function(){return G.retry()}};
g.A(this,this.B);this.Uo=this.L.observe(this.yc.bind(this))},E1w=function(b,L,q,V,Q){var G;
return g.P(function(R){if(R.U==1)return G=new D9(b,L,q,V,Q),g.u(R,Oeu(G),2);BFy(G);return R.return(G)})},BFy=function(b){var L=b.U.actions[0];
return b.j?((L==null?void 0:L.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&b.j[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(b.X=!0),Promise.resolve()):F3F(b)},F3F=function(b){var L,q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v;
return g.P(function(K){switch(K.U){case 1:if(b.j)throw Error("Already processing an action");if(b.RD())return K.return();L=b.U.actions.shift();rdW(b.Ls,!L);if(L===void 0)return K.return();L.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&L.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&hjy(b.U,L.actionId);q="";L.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&L.rootActionId===L.actionId&&(q=L.actionId);V=[L];b.j=V;if(Q=b.Dr[L.entityType]){K.F8(2);break}b.j=
void 0;return g.u(K,F3F(b),3);case 3:return K.return();case 2:G=g.x(V);for(R=G.next();!R.done;R=G.next())h=R.value,G2W(h,2);g.Rq(K,4,5);return g.u(K,vsw(Q,V.map(function(t){return t.action})),7);
case 7:d=K.L,O=g.x(V),B=O.next();case 8:if(B.done){K.F8(10);break}E=B.value;F=d.get(E.action);return g.u(K,pHW(b,E,F),9);case 9:B=O.next();K.F8(8);break;case 10:hjy(b.U,q);case 5:g.OT(K);b.j=void 0;g.B8(K,6);break;case 4:return p=g.dW(K),L9("Orchestration error",p),g.Rq(K,12),g.u(K,MOu(b,V),14);case 14:g.h_(K,5);break;case 12:M=g.dW(K);L9("Orchestration retry error",M);y=g.x(V);for(S=y.next();!S.done;S=y.next())v=S.value,v.retryScheduleIndex<3&&o1w(b.U,[v]);K.F8(5);break;case 6:return g.u(K,F3F(b),
0)}})},pHW=function(b,L,q){var V,Q,G,R,h,d,O,B,E,F,p,M;
return g.P(function(y){switch(y.U){case 1:V=L.retryScheduleIndex+2===3;if(q.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){y.F8(2);break}if(q.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){y.F8(0);break}RjR(L,q,V);if(q.U&&L.retryScheduleIndex+1<3)return g.u(y,MOu(b,[L]),0);G=((Q=q)==null?0:Q.L)?q.L:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";R={entityKey:L.action.entityKey,failureReason:G};h=void 0;g.Nn(b.N)?h="mainVideoDownloadStateEntity":g.DG(b.N)&&(h="musicTrackDownloadMetadataEntity");
if(!h||!q.downloadState){y.F8(7);break}d=g.lB(L.action.entityKey).entityId;return g.u(y,O8(d,h,b.L,q.downloadState),7);case 7:VN(b.Y,R);if(q.downloadState==="DOWNLOAD_STATE_FAILED"&&b.N.T("html5_auto_retry_failed_pde_actions")){y.F8(0);break}L9("Orchestration result is not retryable, deleting action");return g.u(y,Lhy(b.L,e4(L).key),0);case 2:O=void 0;try{O=(B=q.j)==null?void 0:B.map(function(S){return b.createAction(S,L)})}catch(S){return RjR(L,q,V),E={entityKey:L.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},VN(b.Y,E),L9("Orchestration subactions creation error",S),y.return()}RjR(L,q,V,O);if(!O){y.F8(12);break}F=O.map(function(S){return e4(S)});
p=0;case 13:if(!(p<O.length)||b.X){y.F8(15);break}return g.u(y,CZ(b.L,{mode:"readwrite",qo:!0},function(S){var v=[];v.push(AT8(S,F.slice(p,p+10),"offlineOrchestrationActionWrapperEntity"));return g.IX.all(v)}),16);
case 16:p+=10;y.F8(13);break;case 15:if(b.X)return b.X=!1,y.return();case 12:return M=e4(L),g.u(y,Lhy(b.L,M.key),17);case 17:G2W(L,4),g.GF(y)}})},ysq=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p;
return g.P(function(M){q=[];V=Infinity;Q=4E3;G=g.x(L);for(R=G.next();!R.done;R=G.next())h=R.value,d=Number(h.enqueueTimeSec),O=ejT(d),B=h.retryScheduleIndex,E=B!=null&&B>0,O>0&&E?(V=Math.min(V,d),Q=Math.min(O,Q)):q.push(h);isFinite(V)&&(!b.B.isActive()||V<b.V)&&(b.V=V,b.B.start(Q));b.J.ez()||(F=q.length,q=q.filter(function(y){var S;y=((S=y.actionProto)==null?void 0:S.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!TFW.includes(y)}),p=q.length<F,!b.B.isActive()&&p&&b.B.start(1));
q.length>0&&ZeT(b,q);return g.u(M,BFy(b),0)})},Smb=function(b){var L,q,V,Q,G,R,h;
return g.P(function(d){if(d.U==1)return g.u(d,wHq(b),2);L=d.L;q=[];V=g.x(L);for(Q=V.next();!Q.done;Q=V.next())G=Q.value,R=g.lB(G.key),h=R.entityId,d8_(b.U,h)||q.push(G);return g.u(d,ysq(b,q),0)})},ejT=function(b){b=b*1E3-Date.now();
return b>4E3?4E3:b},MOu=function(b,L){var q,V,Q;
return g.P(function(G){q=g.x(L);for(V=q.next();!V.done;V=q.next()){Q=V.value;var R=void 0,h=void 0,d=((h=Q.action)==null?void 0:(R=h.actionMetadata)==null?void 0:R.retryScheduleIntervalsInSeconds)||[1,2,4];R=1;Q.retryScheduleIndex<d.length&&(R=d[Q.retryScheduleIndex]);Q.U=R*1E3+Date.now();Q.retryScheduleIndex++}return g.u(G,IK_(b,L),0)})},Oeu=function(b){var L;
return g.P(function(q){if(q.U==1)return g.u(q,Xy(b.L,"offlineOrchestrationActionWrapperEntity"),2);L=q.L;return g.u(q,ysq(b,L),0)})},ZeT=function(b,L){L.length!==0&&L.forEach(function(q){q=MA(q);
q.retryScheduleIndex<3&&o1w(b.U,[q])})},wHq=function(b,L){var q;
return g.P(function(V){if(V.U==1)return g.u(V,Xy(b.L,"offlineOrchestrationActionWrapperEntity",L),2);q=V.L;return V.return(q.filter(onW))})},IK_=function(b,L){if(L.length===0)return Promise.resolve([]);
L=L.map(function(q){return e4(q)});
return bH_(b.L,L)},W38=function(b){this.M0=b;
this.U=void 0},$8q=function(b,L){var q,V,Q,G;
return g.P(function(R){q=L.videoId;V=!0;if(L.captionTracks.length)Q=aXq(L),b.U=new g.Mt(b.M0,L,Q);else if(L.fk)G=g.tcF(L),b.U=new g.TV(b.M0,L.fk,q,G,L.g3,L.eventId),V=L.g3;else return R.return();return R.return(new Promise(function(h){var d;(d=b.U)==null||d.MS({Pn:function(){return g.P(function(O){if(O.U==1)return g.u(O,b.Pn(q,V),2);h();g.GF(O)})},
TM:function(){}})}))})},HeR=function(b){var L;
return g.P(function(q){if(q.U==1)return g.u(q,En_(b),2);L=q.L;return q.return(!!L&&L.length>0)})},j4=function(b){g.l.call(this);
this.U=b;this.L=this.U.observe(this.B.bind(this))},zjW=function(b,L){var q,V,Q,G,R,h,d;
return g.P(function(O){switch(O.U){case 1:if(L.length===0)return O.return([]);q=L.map(function(B){return g.A2(B,"transfer")});
return g.u(O,Xy(b.U,"transfer",q),2);case 2:V=O.L;Q=V.filter(onW).map(function(B){return g.lB(B.key).entityId});
G=L.filter(function(B){return Q.indexOf(B)===-1});
if(G.length===0)return O.return([]);R=g.x(G);h=R.next();case 3:if(h.done){O.F8(5);break}d=h.value;return g.u(O,Yiw(d),4);case 4:h=R.next();O.F8(3);break;case 5:return O.return(G)}})},ieu=function(b,L,q,V,Q,G){var R,h,d;
return g.P(function(O){R="STREAM_TYPE_UNKNOWN";q.video&&q.audio?(R="STREAM_TYPE_AUDIO_AND_VIDEO",L9("unexpected stream type")):q.video&&!q.audio?R="STREAM_TYPE_VIDEO":!q.video&&q.audio&&(R="STREAM_TYPE_AUDIO");h=g.A2(L,"offlineVideoStreams");d={numBytesDownloaded:Q.toFixed(),numTotalBytes:G.toFixed(),streamType:R,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(V),itag:R==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(q.itag):void 0};return g.u(O,CZ(b,{mode:"readwrite",qo:!0},
function(B){var E=cX(B,h,"offlineVideoStreams"),F=cX(B,g.A2(L,"transfer"),"transfer");return g.IX.all([E,F]).then(function(p){p=g.x(p);var M=p.next().value;p=p.next().value;if(!p)return lP(B,h).then(function(){});
var y=g1W(M);M=K3R(M,V,d,h);var S=kU(B,M,"offlineVideoStreams");g1W(M)>y&&(p.lastProgressTimeMs=Date.now().toString());y=[S];p.offlineVideoStreams||(p.offlineVideoStreams=[]);p.offlineVideoStreams.indexOf(h)===-1&&(p.offlineVideoStreams.push(h),y.push(kU(B,p,"transfer")));return g.IX.all(y)})}),0)})},v1Q=function(b,L){var q,V,Q,G,R;
return g.P(function(h){if(h.U==1)return q=g.A2(L,"offlineVideoStreams"),g.u(h,sH(b,q,"offlineVideoStreams"),2);V=h.L;if(!V||!V.streamsProgress)return h.return();Q=g.x(V.streamsProgress);for(G=Q.next();!G.done;G=Q.next())R=G.value,R.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",R.numTotalBytes!==R.numBytesDownloaded&&(R.numBytesDownloaded=R.numTotalBytes);return g.u(h,mK(b,V,"offlineVideoStreams"),0)})},K3R=function(b,L,q,V){if(b&&b.streamsProgress){V=b;
a:{L=L.itag+";"+L.xtags;for(var Q=b.streamsProgress,G=0;G<Q.length;G++){var R=JSON.parse(Q[G].formatStreamBytes);if(R.itag+";"+R.xtags===L){Q[G]=q;q=Q;break a}}Q.push(q);q=Q}V.streamsProgress=q}else b={key:V,streamsProgress:[q]};return b},g1W=function(b){if(b==null?0:b.streamsProgress){var L=0;
b=b.streamsProgress;for(var q=0;q<b.length;q++){var V=b[q];isNaN(Number(V.numBytesDownloaded))?L9("stream progress bytes number invalid"):L+=Number(V.numBytesDownloaded)}return L}return 0},x8w=function(b,L,q,V){g.l.call(this);
var Q=this;this.L=b;this.api=L;this.uc=q;this.yc=V;this.J=new g.Y$;this.j=new g.Xw(function(){Q.U&&Q.U.transferState==="TRANSFER_STATE_TRANSFERRING"&&Q.J.ez()&&((Q.U.transferRetryCount||0)<3?rK(Q.Y,Q.X,!1,!1):aT(Q.Y,Q.X.videoDetails.videoId),Q.sA("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Ls=this.Wx=0;this.Uo=this.V=!1;this.Ks=g.Xo(this.api.C().experiments,"html5_transfer_processing_logs_interval");this.Eo=new g.OO(this);this.l$={Ygc:function(){return Q.j},
XVr:function(){return Q.yc},
Rv:function(){return Q.J}};
this.Dr=this.L.observe(this.g5.bind(this));this.Y=new Aoy(L,this);this.SP=new W38(L);this.eP=new j4(this.L);this.Hx=this.J.listen("publicytnetworkstatus-online",this.wy.bind(this));this.Qc=this.J.listen("publicytnetworkstatus-offline",this.LZv.bind(this));this.Uo=this.api.C().T("html5_less_transfer_processing_logs");g.A(this,this.Eo);this.Eo.K(L,"offlinetransferpause",this.B9v);if(g.Nn(this.api.C()))this.B="mainVideoDownloadStateEntity";else if(g.DG(this.api.C())||g.hu(this.api.C()))this.B="musicTrackDownloadMetadataEntity"},
tO8=function(b){return g.P(function(L){if(L.U==1)L=g.u(L,OHT(),2);
else{var q=b.eP;var V=g.kL();V=Object.keys(V);q=zjW(q,V);L=g.u(L,q,0)}return L})},cR=function(b,L){L=L===void 0?!1:L;
var q;return g.P(function(V){if(V.U==1){if(b.U)throw Error("Already downloading a video");b.Ls=0;b.V=!1;return g.u(V,aKR(b),2)}return V.U!=4?(q=V.L,DFq(b.uc,!q),q&&b.J.ez()?L?g.u(V,new Promise(function(Q){g.y9(Q,1E3)}),4):V.F8(4):(!q&&b.U&&uX(b),V.F8(0))):g.u(V,rsT(b,q),0)})},D8_=function(b){return g.P(function(L){if(L.U==1)return b.X?g.u(L,aT(b.Y,b.X.videoDetails.videoId),3):L.F8(0);
uX(b);g.GF(L)})},jvb=function(b,L){var q,V,Q;
return g.P(function(G){switch(G.U){case 1:return g.Rq(G,2),(q=!!L.captionTracks.length||!!L.fk)?g.u(G,HeR(L.videoId),4):G.return();case 4:return(V=G.L)?G.return():g.u(G,$8q(b.SP,L),5);case 5:g.h_(G,0);break;case 2:Q=g.dW(G),L9("Caption downloading error",Q,L.cotn),g.GF(G)}})},rsT=function(b,L){var q,V,Q,G,R,h;
return g.P(function(d){switch(d.U){case 1:if(b.V)return d.return();b.V=!0;b.U=L;q=g.lB(b.U.key);V=q.entityId;Q=void 0;if(b.U.transferState==="TRANSFER_STATE_TRANSFERRING")return g.u(d,PR(b,V),7);if(b.U.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||b.U.transferRetryCount||b.U.hasLoggedFirstStarted){d.F8(3);break}return g.u(d,PR(b,V),5);case 5:return Q=d.L,b.U.hasLoggedFirstStarted=!0,g.u(d,uSy(b),6);case 6:ufb({videoId:V,Ef:b.U,offlineModeType:Q},void 0,void 0,!0);d.F8(3);break;case 7:Q=d.L,
RT({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:V,Ef:b.U,offlineModeType:Q});case 3:return g.u(d,csW(b),8);case 8:return G=null,g.Rq(d,9),g.u(d,PWW(b,L),11);case 11:G=d.L;b.X=G;g.h_(d,10);break;case 9:return R=g.dW(d),L9("error getting player response",R,L.cotn),g.u(d,b.sA("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return d.return();case 10:return h=Ywu(b.api.C(),L.cotn,G),g.u(d,jvb(b,h),13);case 13:return g.u(d,CfW(h.videoId),
14);case 14:h.lE=d.L;var O=b.Y,B=h,E=L.maximumDownloadQuality;B.getPlayerResponse();g.Au(B.videoId,2);O.B=2;O.L=!1;var F;(F=O.player)==null||F.dispose();O.player=O.api.oA(B);B={};O.player.HB((B.localmediachange=O.D0,B.signatureexpired=O.c_,B.statechange=O.eZs,B),O);O.T("html5_generate_content_po_token")&&O.player.bx();E=O.KD(E);O.player.LZ(g.rp(E,E,!0,"m"),!1);O.player.P$(!1);b.j.start(108E5);g.GF(d)}})},aKR=function(b){var L,q;
return g.P(function(V){if(V.U==1)return g.u(V,Xy(b.L,"transfer"),2);L=V.L;q=L.filter(n18).sort(k2T);return q.length===0?V.return():V.return(q[0])})},csW=function(b){var L,q,V;
return g.P(function(Q){if(Q.U==1){if(!b.U)return n9(b,"onTransferStart"),Q.return();b.j.start(108E5);return g.u(Q,kx(b,"TRANSFER_STATE_TRANSFERRING"),2)}L=b.U;return(V=((q=L)==null?0:q.key)?g.lB(L.key).entityId:"")&&b.B?g.u(Q,O8(V,b.B,b.L,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):Q.F8(0)})},sP_=function(b){var L,q,V,Q;
g.P(function(G){switch(G.U){case 1:if(!b.U){n9(b,"onTransferPausedByUser");G.F8(2);break}L=b.U;b.j.stop();return g.u(G,kx(b,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:V=((q=L)==null?0:q.key)?g.lB(L.key).entityId:"";if(!V||!b.B){G.F8(4);break}return g.u(G,O8(V,b.B,b.L,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.u(G,PR(b,V),6);case 6:Q=G.L,PVT({videoId:V,Ef:L,offlineModeType:Q});case 2:uX(b),cR(b),g.GF(G)}})},XVW=function(b){var L,q,V;
g.P(function(Q){if(Q.U==1){if(!b.U)return n9(b,"onTransferPausedByNetwork"),Q.return();b.j.stop();return g.u(Q,kx(b,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(Q.U!=3)return L=b.U,(V=((q=L)==null?0:q.key)?g.lB(L.key).entityId:"")&&b.B?g.u(Q,O8(V,b.B,b.L,"DOWNLOAD_STATE_PAUSED"),3):Q.F8(3);uX(b);g.GF(Q)})},lKW=function(b){var L,q,V,Q,G;
g.P(function(R){switch(R.U){case 1:if(!b.U)return n9(b,"onTransferComplete"),R.return();L=b.U;b.j.stop();if(!L||!b.X){R.F8(2);break}q=Ywu(b.api.C(),L.cotn,b.X);return g.u(R,jvb(b,q),2);case 2:return g.u(R,kx(b,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:Q=((V=L)==null?0:V.key)?g.lB(L.key).entityId:"";if(!Q||!b.B){R.F8(5);break}return g.u(R,O8(Q,b.B,b.L,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.u(R,v1Q(b.L,Q),7);case 7:return g.u(R,PR(b,Q),8);case 8:G=R.L,RT({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:Q,Ef:L,offlineModeType:G}),uX(b),cR(b),g.GF(R)}})},AsR=function(b,L,q){var V,Q;
g.P(function(G){switch(G.U){case 1:if(!b.U)return n9(b,"onTransferProgress: "+L),G.return();if(b.U.transferState==="TRANSFER_STATE_TRANSFERRING"){G.F8(2);break}return g.u(G,csW(b),2);case 2:V=Date.now();if(!(V-b.Wx>1E3)){G.F8(4);break}b.Wx=V;return g.u(G,ieu(b.L,q.videoId,q.L,q.HJ,q.bytesDownloaded,q.U),5);case 5:if(b.Uo&&!(b.Uo&&V-b.Ls>b.Ks)){G.F8(4);break}b.Ls=V;return g.u(G,PR(b,L),7);case 7:Q=G.L,ufb({videoId:L,Ef:b.U,offlineModeType:Q},q.bytesDownloaded,q.U);case 4:b.j.start(108E5),g.GF(G)}})},
Ymq=function(b){var L=(b.U.transferRetryCount||0)<3;
L&&(b=b.U,b.transferRetryCount=(b.transferRetryCount||0)+1);return L},CW_=function(b,L){L=L===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":L;
var q,V,Q,G;return g.P(function(R){if(R.U==1)return b.U||n9(b,"setTransferToFailed: "+L),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L==="TRANSFER_FAILURE_REASON_NETWORK"?q="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":L==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.u(R,kx(b,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",L),2);if(R.U!=3)return VN(b.yc,{entityKey:(V=b.U)==null?void 0:V.key,failureReason:q}),
Q=b.U?g.lB(b.U.key).entityId:"",g.u(R,PR(b,Q),3);G=R.L;var h={videoId:Q,Ef:b.U,offlineModeType:G},d=L,O={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};d&&(O.transferFailureReason=d,O.failureReason=nnW(d));RT(O,h);g.GF(R)})},kx=function(b,L,q,V){var Q;
return g.P(function(G){if(G.U==1){if(!b.U)return n9(b,"saveTransferState: "+L),G.return();b.U.transferState=L;b.U.failureReason=V;g.Rq(G,2);return g.u(G,uSy(b,function(R){return q?PX(R,"offlineVideoStreams",b.U.offlineVideoStreams).then(function(h){for(var d=g.x(h),O=d.next();!O.done;O=d.next())if((O=O.value)&&O.streamsProgress){O=g.x(O.streamsProgress);for(var B=O.next();!B.done;B=O.next())B.value.streamState=q}return AT8(R,h.filter(function(E){return!!E}),"offlineVideoStreams")}):g.IX.resolve(void 0)}),
4)}if(G.U!=2)return g.h_(G,0);
Q=g.dW(G);return Q instanceof g.M$&&Q.type==="QUOTA_EXCEEDED"?g.u(G,b.sA("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):G.F8(0)})},uSy=function(b,L){var q;
return g.P(function(V){if(!b.U)return V.return();q=b.U;return g.u(V,CZ(b.L,{mode:"readwrite",qo:!0},function(Q){var G=[kU(Q,q,"transfer")];L&&G.push(L(Q));return g.IX.all(G)}),0)})},uX=function(b){b.U=void 0;
b.X=void 0;b.j.stop()},PWW=function(b,L){var q,V,Q,G,R;
return g.P(function(h){if(h.U==1)return q=g.lB(L.key),V=q.entityId,Q=g.A2(V,"playbackData"),g.u(h,sH(b.L,Q,"playbackData"),2);G=h.L;if((R=G)==null?0:R.playerResponseJson)return h.return(JSON.parse(G.playerResponseJson));throw Error("No PlayerResponse found");})},n9=function(b,L){b.api.Bx("woffle",{mcte:L});
L9("missing current transfer entity.")},PR=function(b,L){var q,V,Q;
return g.P(function(G){if(G.U==1)return g.u(G,sH(b.L,g.A2(L,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);q=G.L;return G.return((Q=(V=q)==null?void 0:V.offlineModeType)!=null?Q:void 0)})},n18=function(b){return m8y[b.transferState]!==void 0},k2T=function(b,L){var q=m8y[b.transferState],V=m8y[L.transferState];
return q!==V?q-V:Number(b.enqueuedTimestampMs)-Number(L.enqueuedTimestampMs)},lX=function(b,L){var q=this;
this.N=b;this.api=L;this.J=new g.Y$;this.X=new g.Oe;this.l$={ea:function(){return q.B.l$.ea()},
Rv:function(){return q.J},
P6t:function(){return q.B},
Zo:function(){return q.Zo()},
S4:function(){return q.S4()},
VS:function(){return q.VS()},
Bf:function(){return q.Bf()},
h1:function(){return q.h1()},
PA:function(V){return q.PA(V)}};
this.B=new xFq(function(){return sv_(q)},function(){q.VS()},this.api.y$(),this.api.T.bind(this.api));
this.U=new qA(this.api);tpF(this.B)},sv_=function(b){return g.P(function(L){b.api.vx("onOrchestrationBecameLeader");
return g.u(L,b.S4(),0)})},fKu=function(b){var L,q;
return g.P(function(V){if(V.U==1)return g.u(V,fZ(),2);if(V.U!=3){L=V.L;if(!L)return L9("PES is undefined"),V.return();b.L=new x8w(L,b.api,b.B,b.U);q=b.mu(L);return g.u(V,E1w(L,q,b.B,b.U,b.N),3)}b.Y=V.L;return g.u(V,XHT(b),0)})},XHT=function(b){var L;
return g.P(function(q){switch(q.U){case 1:if(!b.L)return L9("transferManager is undefined"),q.return();if(b.L.U){q.F8(2);break}return g.u(q,cR(b.L),2);case 2:if(!b.N.T("woffle_enable_main_downloads_library")){q.F8(4);break}return g.u(q,b.Gi(),4);case 4:if(!b.N.T("html5_offline_playback_position_sync")){q.F8(6);break}return g.u(q,b.Qm(),7);case 7:return g.u(q,b.PA(864E5),6);case 6:return g.u(q,b.refreshAllStaleEntities(43200,!0),9);case 9:return g.u(q,b.cG(),10);case 10:if(!b.N.T("html5_retry_downloads_for_expiration")){q.F8(11);
break}return g.u(q,b.h1(),11);case 11:return b.V=g.wm(function(){b.refreshAllStaleEntities(43200,!0);b.cG()},9E5),g.L7(g.VX(),function(){return b.Bf()}),g.u(q,fZ(),13);
case 13:return L=q.L,g.u(q,vnb(L),14);case 14:apq(b.B),g.GF(q)}})},Jsw=function(){var b,L,q,V,Q,G;
return g.P(function(R){switch(R.U){case 1:return g.u(R,fZ(),2);case 2:b=R.L;if(!b)return R.return([]);L=Date.now()/1E3;return g.u(R,Xy(b,"offlineVideoPolicy"),3);case 3:q=R.L,V=g.x(q),Q=V.next();case 4:if(Q.done){R.F8(6);break}G=Q.value;if(!(G.expirationTimestamp&&Number(G.expirationTimestamp)<L)){R.F8(5);break}G.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";G.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.u(R,mK(b,G,"offlineVideoPolicy"),5);
case 5:Q=V.next();R.F8(4);break;case 6:return R.return(q.map(function(h){return h.key}))}})},AV=function(b,L,q,V,Q){var G,R,h;
return g.P(function(d){if(d.U==1)return g.u(d,fZ(),2);G=d.L;if(!G)return d.return([]);R=L.map(function(O){var B=g.A2(O,q);B={actionType:V,entityKey:B,actionMetadata:Object.assign({},CV8(),Q)};V!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(B.actionMetadata.priority=0);O=new p9(q,O,B);return e4(O)});
h=bH_(G,R);tpF(b.B);return d.return(h)})},U88=function(b,L,q,V){var Q,G,R,h,d,O,B,E;
return g.P(function(F){switch(F.U){case 1:Q=[],G=g.x(L),R=G.next();case 2:if(R.done){F.F8(4);break}h=R.value;if(h.upToDate||q&&!h.shouldAutoSyncMetadata||!h.playlistId){F.F8(3);break}d={};switch(V){case "mainPlaylistEntity":O={nextAutoRefreshIntervalSeconds:h.checkInSeconds,autoSync:q};d={mainPlaylistEntityActionMetadata:O};break;case "musicPlaylist":B={autoSync:q},d={musicPlaylistEntityActionMetadata:B}}return g.u(F,AV(b,[h.playlistId],V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d),6);case 6:(E=
F.L)&&Q.push.apply(Q,g.a(E));case 3:R=G.next();F.F8(2);break;case 4:return F.return(Q)}})},bhW=function(b,L){var q;
return g.P(function(V){return L.length?(q=CV8(),g.DQ(q,xx,{isEnqueuedForExpiredStreamUrlRefetch:!0}),b.api.Bx("qrd",{v:L.length}),V.return(AV(b,L,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q))):V.return([])})},Lxu=function(b,L,q){this.U=b;
this.N=L;this.B=q},QhT=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K;
return g.P(function(t){switch(t.U){case 1:return q=NA(L),V=g.lB(L.entityKey),Q=V.entityId,G=[],g.Rq(t,2),g.u(t,qeu(b,Q),4);case 4:G=t.L;if(!(b.N.T("woffle_enable_main_downloads_library")&&((R=G)==null?0:R.length))){t.F8(5);break}return g.u(t,RKT(b.U,[L.entityKey]),5);case 5:g.h_(t,3);break;case 2:return h=g.dW(t),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.M$&&h.type==="QUOTA_EXCEEDED"?(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):L9("Playlist add error"),t.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,d,O));case 3:B=[];if(!b.N.T("html5_offline_prevent_redownload_downloaded_video")){t.F8(7);break}return g.u(t,AdR(b.U,"mainVideoEntity",G),8);case 8:G=t.L;case 7:if((E=G)==null?0:E.length)for(F=g.x(G),p=F.next();!p.done;p=F.next())if(M=p.value,y=M.offlineVideoData,S=void 0,(S=y)==null?0:S.videoId)v=void 0,K=Number(((v=L.actionMetadata)==null?void 0:v.priority)||
0)+1,B.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y.videoId,"mainVideoEntity",K,Yx,V7Q(L,y,Q)));return t.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,B))}})},Ry_=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT,v8,z,UT,Cy,hF,Ky,I,bh,ws,o$,m5,h3,JF,qu,H9,H,w,W,D,m,NT,f,Y,c,vJ,xq,Zo,K3,Qw,z$,nJ,a$,Xs,ih,kV,tF,SR,n3,$P,W8;
return g.P(function(be){switch(be.U){case 1:return q=NA(L),V=L.entityKey,Q=g.lB(V).entityId,G=[],R=!1,Q==="!*$_ALL_ENTITIES_!*$"?(R=!0,g.u(be,Xy(b.U,"mainPlaylistEntity"),5)):g.u(be,sH(b.U,V,"mainPlaylistEntity"),4);case 4:(h=be.L)&&G.push(h);be.F8(3);break;case 5:G=be.L;case 3:if((d=G)==null||!d.length)return be.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));O=g.T(L.actionMetadata,Gzs);E=(B=O)==null?void 0:B.nextAutoRefreshIntervalSeconds;p=(F=O)==null?void 0:F.autoSync;M=[];S=y=
!0;v=!1;if(!R&&p===!1){be.F8(6);break}g.Rq(be,7);return g.u(be,yoy(0,!!p,!0,G),9);case 9:M=be.L;g.h_(be,8);break;case 7:K=g.dW(be);if(!(K instanceof Error&&K.message==="No data")){K instanceof Error&&K.message==="Empty response body"&&L9(K.message);be.F8(8);break}return Q==="!*$_ALL_ENTITIES_!*$"?g.u(be,bms(b.U,L,b.B,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.u(be,JdF(Q,b.U,L,b.B),8);case 8:if(!M.length||!R&&M[0].playlistId!==Q)return be.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));case 6:if(R){t=[];r=g.x(M);for(k=r.next();!k.done;k=r.next())n=k.value,n.upToDate||p&&!n.shouldAutoSyncMetadata||!n.playlistId||(G$={nextAutoRefreshIntervalSeconds:n.checkInSeconds,autoSync:p},t.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n.playlistId,"mainPlaylistEntity",0,Yx,{mainPlaylistEntityActionMetadata:G$})));return be.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,t))}M.length&&(L3=M[0],v=!!L3.upToDate,p&&(y=(VJ=L3.shouldAutoSyncMetadata)!=null?VJ:!0,S=(oY=L3.shouldAutoSyncVideos)!=
null?oY:!0,L3.checkInSeconds&&(E=L3.checkInSeconds)));if(v||!y)return be.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));Eo=[];qT=G[0];if(!qT.downloadState){S5=void 0;be.F8(15);break}return g.u(be,sH(b.U,qT.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:S5=be.L;case 15:return f3=S5,PJ=((Nu=f3)==null?0:Nu.addedTimestampMillis)?String(f3.addedTimestampMillis):void 0,g.Rq(be,17),g.u(be,qeu(b,Q,PJ,E),19);case 19:Eo=be.L;g.h_(be,18);break;case 17:X2=g.dW(be);if(!(X2 instanceof
Error&&X2.message==="No data for playlist")){if(X2 instanceof Error&&X2.message==="Empty response body for playlist")L9(X2.message);else return Do="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",sT="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X2 instanceof g.M$&&X2.type==="QUOTA_EXCEEDED"&&(Do="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",sT="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),be.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,Do,sT));
be.F8(18);break}return g.u(be,JdF(Q,b.U,L,b.B),18);case 18:if(!S)return be.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));v8=[];z=new Map;if((UT=Eo)==null?0:UT.length)for(Cy=g.x(Eo),hF=Cy.next();!hF.done;hF=Cy.next())Ky=hF.value,I=Ky.offlineVideoData,bh=void 0,((bh=I)==null?0:bh.videoId)&&z.set(I.videoId,I);ws=new Map;o$=[];if((m5=qT)==null?0:(h3=m5.videos)==null?0:h3.length)for(JF=g.x(qT.videos),qu=JF.next();!qu.done;qu=JF.next())if(H9=qu.value,H=JSON.parse(g.lB(H9).entityId),w=
H.videoId)z.has(w)?(ws.set(w,z.get(w)),z.delete(w)):o$.push(w);D=Number(((W=L.actionMetadata)==null?void 0:W.priority)||0)+1;m=g.x(z.entries());for(NT=m.next();!NT.done;NT=m.next())f=NT.value,Y=g.x(f),c=Y.next().value,vJ=Y.next().value,xq=c,Zo=vJ,v8.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",xq,"mainVideoEntity",D,Yx,V7Q(L,Zo,Q)));K3=g.x(ws.entries());for(Qw=K3.next();!Qw.done;Qw=K3.next())z$=Qw.value,nJ=g.x(z$),a$=nJ.next().value,Xs=nJ.next().value,ih=a$,kV=Xs,v8.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
ih,"mainVideoEntity",D,Yx,V7Q(L,kV,Q)));tF=g.x(o$);for(SR=tF.next();!SR.done;SR=tF.next())n3=SR.value,$P={playlistId:Q},W8={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:$P},v8.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",n3,"mainVideoEntity",0,Yx,W8));return be.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,v8))}})},Nn_=function(b,L){var q,V,Q,G;
return g.P(function(R){switch(R.U){case 1:return q=NA(L),g.Rq(R,2),V=g.lB(L.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.u(R,bms(b.U,L,b.B,(Q=L.actionMetadata)==null?void 0:(G=Q.offlineLoggingData)==null?void 0:G.offlineDeleteReason),5):g.u(R,JdF(V,b.U,L,b.B),6);case 6:if(!b.N.T("woffle_enable_main_downloads_library")){R.F8(5);break}return g.u(R,NXs(b.U,L.entityKey),5);case 5:g.h_(R,3);break;case 2:return g.dW(R),R.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},qeu=function(b,L,q,V){var Q,G,R,h,d,O,B;
return g.P(function(E){switch(E.U){case 1:return g.u(E,TXb([L]),2);case 2:return Q=E.L,g.u(E,o0_(b,Q[0],q,V),3);case 3:return G=E.L,R=G.mainPlaylistEntity,h=G.PGc,O=XP_(R,(d=h)==null?void 0:d.avatar),g.Rq(E,4),g.u(E,Z9(O),6);case 6:g.h_(E,5);break;case 4:B=g.dW(E),B instanceof Error&&B.message==="Failed to fetch"&&L9(B.message);case 5:return E.return(Q[0].videos)}})},o0_=function(b,L,q,V){var Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r;
return g.P(function(k){switch(k.U){case 1:Q=Date.now().toString();q||(q=Q);G=L.videos;R=L.playlistId;h=[];d=[];if(G)for(O=g.x(G),B=O.next();!B.done;B=O.next()){E=B.value;F=E.offlineVideoData;if(!F||!F.videoId)throw L9("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");p=F.videoId;M={videoId:p,playlistId:R};y={id:g.A2(JSON.stringify(M),"mainPlaylistVideoEntity"),video:g.A2(p,"mainVideoEntity")};h.push(y);d.push(y.id)}v={key:g.A2(R,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:q,lastSyncedTimestampMillis:Q};K={key:g.A2(R,"mainPlaylistEntity"),playlistId:R,videos:d,title:L.title,thumbnailStyleData:hy_(L),visibility:d9y(L),downloadState:v.key};L.channel&&(t=L.channel.offlineChannelData,S=OhW(g.A2(R,"ytMainChannelEntity"),t),K.channelOwner=S.id);((r=K)==null?0:r.entityMetadata)?(K.entityMetadata.offlineLastModifiedTimestampSeconds=L.lastModifiedTimestamp,V&&(K.entityMetadata.nextAutoRefreshIntervalSeconds=String(V))):K&&(K.entityMetadata={nextAutoRefreshIntervalSeconds:V?
String(V):void 0,offlineLastModifiedTimestampSeconds:L.lastModifiedTimestamp});g.Rq(k,2);return g.u(k,CZ(b.U,{mode:"readwrite",qo:!0},function(n){var G$=kU(n,K,"mainPlaylistEntity"),L3=kU(n,v,"mainPlaylistDownloadStateEntity");G$=[G$,L3];L3=g.x(h);for(var VJ=L3.next();!VJ.done;VJ=L3.next())G$.push(kU(n,VJ.value,"mainPlaylistVideoEntity"));S&&G$.push(kU(n,S,"ytMainChannelEntity"));return g.IX.all(G$)}),4);
case 4:g.h_(k,3);break;case 2:throw g.dW(k),L9("PES failure for playlist"),Error("PES failure for playlist");case 3:return k.return({mainPlaylistEntity:K,PGc:S,nRs:h})}})},OhW=function(b,L){return{id:b,
channelId:L.channelId,title:L.title,avatar:L.thumbnail}},hy_=function(b){var L=[],q=b.videos;
q&&q.length>0&&L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:q[0].offlineVideoData.thumbnail}}});if((b=b.additionalMetadadatas)&&b.length>0)for(b=g.x(b),q=b.next();!q.done;q=b.next()){var V=q.value.offlineBundleItemPlaylistData,Q=void 0;q=(Q=V)==null?void 0:Q.style;Q=void 0;V={collageThumbnail:{coverThumbnail:(Q=V)==null?void 0:Q.coverThumbnail}};switch(q){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:V});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:V})}}return L},d9y=function(b){switch(b.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},V7Q=function(b,L,q){L={offlineVideoData:L,
playlistId:q};if(b=g.T(b.actionMetadata,Gzs))L.maximumDownloadQuality=b.maximumDownloadQuality;return{mainVideoEntityActionMetadata:L}},Bn_=function(b,L,q){this.U=b;
this.N=L;this.B=q},p2w=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M;
return g.P(function(y){switch(y.U){case 1:return q=NA(L),V=g.lB(L.entityKey),Q=V.entityId,G=g.T(L.actionMetadata,C9),h=!((R=G)==null?0:R.playlistId),g.Rq(y,2),g.u(y,E0s(b,Q,void 0,(d=G)==null?void 0:d.offlineVideoData,h),4);case 4:g.h_(y,3);break;case 2:return O=g.dW(y),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.M$&&O.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
y.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,B,E));case 3:F=1;F=Number(((p=L.actionMetadata)==null?void 0:p.priority)||0)+1;var S=(S=g.T(L.actionMetadata,C9))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;M=iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q,"playbackData",F,FxW,S);return y.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,[M]))}})},M7y=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K;
return g.P(function(t){switch(t.U){case 1:return q=NA(L),V=g.lB(L.entityKey),Q=V.entityId,g.u(t,sH(b.U,L.entityKey,"mainVideoEntity"),2);case 2:G=t.L;if(!G){R=void 0;t.F8(3);break}return g.u(t,sH(b.U,G.downloadState,"mainVideoDownloadStateEntity"),4);case 4:R=t.L;case 3:h=R;if(!G||!h)return t.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.Rq(t,5);return g.u(t,E0s(b,Q,h.addedTimestampMillis,(O=g.T(L.actionMetadata,C9))==null?void 0:O.offlineVideoData),7);case 7:B=1;B=Number(((E=
L.actionMetadata)==null?void 0:E.priority)||0)+1;d=iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q,"playbackData",B,FxW);g.h_(t,6);break;case 5:F=g.dW(t);if(!(F instanceof Error&&F.message==="No data")){if(F instanceof Error&&F.message==="Empty response body")L9(F.message);else return p="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.M$&&F.type==="QUOTA_EXCEEDED"&&(p="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),t.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,p,M));t.F8(6);break}return g.u(t,S4(b.U,Q),9);case 9:y=t.L;S=g.T(L.actionMetadata,C9);if(K=(v=S)==null?void 0:v.playlistId)y.playlistId=K;y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.u(t,yN(Q,b.U,L,b.B,y),6);case 6:return t.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,d?[d]:void 0))}})},eyw=function(b,L){var q,V,Q,G,R,h,d,O,B,E;
return g.P(function(F){switch(F.U){case 1:return q=NA(L),g.Rq(F,2),V=g.lB(L.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.u(F,bms(b.U,L,b.B,(B=L.actionMetadata)==null?void 0:(E=B.offlineLoggingData)==null?void 0:E.offlineDeleteReason),5):g.u(F,S4(b.U,V),6);case 6:Q=F.L;G=g.T(L.actionMetadata,C9);if(h=(R=G)==null?void 0:R.playlistId)Q.playlistId=h;Q.offlineDeleteReason=(d=L.actionMetadata)==null?void 0:(O=d.offlineLoggingData)==null?void 0:O.offlineDeleteReason;return g.u(F,yN(V,b.U,L,b.B,Q),7);
case 7:if(!b.N.T("woffle_enable_main_downloads_library")){F.F8(5);break}return g.u(F,NXs(b.U,L.entityKey),5);case 5:g.h_(F,3);break;case 2:return g.dW(F),F.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},E0s=function(b,L,q,V,Q){var G,R,h,d,O,B;
return g.P(function(E){switch(E.U){case 1:if(G=V){E.F8(2);break}return g.u(E,eKb([L]),3);case 3:R=E.L,G=R[0];case 2:return g.u(E,Tnu(b,G,q,Q),4);case 4:h=E.L;d=h.mainVideoEntity;O=h.channelEntity;g.Rq(E,5);var F=FO(d.thumbnail),p=FO(O.avatar);return g.u(E,Z9(F.concat(p)),7);case 7:g.h_(E,0);break;case 5:B=g.dW(E),B instanceof Error&&B.message==="Failed to fetch"&&L9(B.message),g.GF(E)}})},Tnu=function(b,L,q,V){var Q,G,R,h,d,O,B,E,F,p,M,y,S;
return g.P(function(v){switch(v.U){case 1:q||(q=Date.now().toString());G=(Q=L.channel)==null?void 0:Q.offlineChannelData;R={id:g.A2(L.videoId,"ytMainChannelEntity"),channelId:G.channelId,title:G.title,avatar:G.thumbnail};h={key:g.A2(L.videoId,"mainVideoDownloadStateEntity"),playbackData:g.A2(L.videoId,"playbackData"),addedTimestampMillis:q,videoDownloadContextEntity:g.A2(L.videoId,"videoDownloadContextEntity")};d={key:g.A2(L.videoId,"videoPlaybackPositionEntity"),videoId:L.videoId,lastPlaybackPositionSeconds:"0"};
b.N.T("html5_offline_playback_position_sync")&&(O={playbackPosition:d.key});B=g.A2(L.videoId,"mainVideoEntity");E={key:B,videoId:L.videoId,title:L.title,thumbnail:L.thumbnail,localizedStrings:{viewCount:L.shortViewCountText},userState:O,lengthSeconds:L.lengthSeconds?Number(L.lengthSeconds):void 0,publishedTimestampMillis:L.publishedTimestamp?(Number(L.publishedTimestamp)*1E3).toString():void 0,formattedDescription:L.description,owner:R.id,downloadState:h.key};if(!b.N.T("woffle_enable_main_downloads_library")||
!V){v.F8(2);break}return g.u(v,GST(b.U,[B]),3);case 3:if(M=v.L)F=M.mainDownloadsLibraryEntity,p=M.mainDownloadsListEntity;case 2:return S=lp_,y={key:g.A2(L.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.DQ(h,S,y),g.u(v,CZ(b.U,{mode:"readwrite",qo:!0},function(K){var t=kU(K,R,"ytMainChannelEntity"),r=kU(K,h,"mainVideoDownloadStateEntity"),k=kU(K,E,"mainVideoEntity");t=[t,r,k];b.N.T("html5_offline_playback_position_sync")&&(r=kU(K,d,"videoPlaybackPositionEntity"),
t.push(r));F&&(r=kU(K,F,"mainDownloadsLibraryEntity"),t.push(r));p&&(r=kU(K,p,"mainDownloadsListEntity"),t.push(r));y&&(K=kU(K,y,"downloadStatusEntity"),t.push(K));return g.IX.all(t)}),4);
case 4:return v.return({mainVideoEntity:E,channelEntity:R})}})},Zhy=function(b,L,q){this.U=b;
this.N=L;this.B=q},w2_=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT;
return g.P(function(S5){switch(S5.U){case 1:return q=NA(L),V=[],g.u(S5,Df.getInstance(),2);case 2:Q=S5.L;if(!Q){S5.F8(3);break}return g.u(S5,Q.get("sdois"),4);case 4:return G=S5.L,g.u(S5,(h=Q)==null?void 0:h.get("lmqf"),5);case 5:R=S5.L;case 3:g.Rq(S5,6);if(G===void 0)throw Error("prefStorage or opt-in state is undefined");d=[];if(G){S5.F8(8);break}return g.u(S5,QPQ(b.U),9);case 9:d=S5.L,d.reverse();case 8:if(!d.length){S5.F8(10);break}O=g.x(d);B=O.next();case 11:if(B.done){S5.F8(10);break}E=B.value;
if(!E){S5.F8(12);break}F=g.lB(E).entityId;return g.u(S5,S4(b.U,F),14);case 14:return p=S5.L,p.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.u(S5,yN(F,b.U,{entityKey:E,actionType:L.actionType},b.B,p),12);case 12:B=O.next();S5.F8(11);break;case 10:return g.u(S5,Sis(G,(M=R)!=null?M:"SD"),16);case 16:return y=S5.L,g.u(S5,LOR(y),17);case 17:S=Vmy(y);if(!b.N.T("woffle_enable_main_downloads_library")){S5.F8(18);break}if(G){S5.F8(19);break}return g.u(S5,NXs(b.U,g.xv),19);case 19:return g.u(S5,
RKT(b.U,[g.xv]),18);case 18:if((v=S)==null?0:v.length)for(K=g.x(S),t=K.next();!t.done;t=K.next())if(k=r=t.value,n=k.actionType,G$=k.entityKey,L3=k.actionMetadata,n&&G$&&L3&&!g.T(L3,yIW)){n==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(L3.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(VJ=g.T(r.actionMetadata,C9))VJ.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",r.actionMetadata=Object.assign({},r.actionMetadata,{mainVideoEntityActionMetadata:VJ});V.push(r)}g.h_(S5,
7);break;case 6:return oY=g.dW(S5),Eo="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",qT="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",oY instanceof g.M$&&oY.type==="QUOTA_EXCEEDED"&&(Eo="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",qT="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S5.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,Eo,qT));case 7:return S5.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,V))}})},SeW=function(){lX.apply(this,
arguments);
this.Uo="mainVideoEntity"},I28=function(b,L,q){L=L===void 0?43200:L;
q=q===void 0?!0:q;var V=V===void 0?!1:V;var Q,G,R;return g.P(function(h){switch(h.U){case 1:if(!b.J.ez())return h.return([]);Q=[];g.Rq(h,2);return g.u(h,yoy(L,q,V),4);case 4:Q=h.L;g.h_(h,3);break;case 2:G=g.dW(h),G instanceof Error&&G.message==="No data"||G instanceof Error&&G.message==="Empty response body"&&L9(G.message);case 3:return R=U88(b,Q,q,"mainPlaylistEntity"),h.return(R)}})},Wxs=function(b,L,q,V){V=V===void 0?!1:V;
var Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K;return g.P(function(t){switch(t.U){case 1:return Q=[],g.u(t,wV8(),2);case 2:return(G=t.L)||V?g.u(t,IS_(L,q),3):t.return([]);case 3:R=t.L;if((h=R)==null||!h.length)return t.return([]);d={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};O=g.x(R);B=O.next();case 4:if(B.done){t.F8(6);break}F=E=B.value;p=F.actionType;M=F.entityKey;y=F.actionMetadata;if(!(p&&M&&y)||g.T(y,yIW)){t.F8(5);break}p==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(y.offlineLoggingData=
d);S=g.lB(M);v=S.entityId;return g.u(t,AV(b,[v],"mainVideoEntity",p,y),8);case 8:K=t.L,Q=Q.concat(K);case 5:B=O.next();t.F8(4);break;case 6:return t.return(Q)}})},$9w=function(b,L){this.U=b;
this.B=L},zyW=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v;
return g.P(function(K){switch(K.U){case 1:return q=NA(L),V=g.lB(L.entityKey),Q=V.entityId,G=[],g.Rq(K,2),g.u(K,HhT(b,Q),4);case 4:G=K.L;if((R=G)==null||!R.length){K.F8(5);break}return g.u(K,BXy(b.U,L.entityKey),5);case 5:g.h_(K,3);break;case 2:return h=g.dW(K),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.M$&&h.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,d,O));case 3:return B=[],g.u(K,AdR(b.U,"musicTrack",G),7);case 7:G=K.L;if(G.length)for(E=g.x(G),F=E.next();!F.done;F=E.next())if(p=F.value,M=p.offlineVideoData,y=void 0,(y=M)==null?0:y.videoId)S=void 0,v=Number(((S=L.actionMetadata)==null?void 0:S.priority)||0)+1,B.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",v,mC,HR(L,M,Q)));return K.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,B))}})},
g0s=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT,v8,z,UT,Cy,hF,Ky,I,bh,ws,o$,m5,h3,JF,qu,H9,H,w,W,D,m,NT,f,Y,c,vJ;
return g.P(function(xq){switch(xq.U){case 1:return q=NA(L),V=L.entityKey,Q=g.lB(V).entityId,G=[],R=!1,Q==="!*$_ALL_ENTITIES_!*$"?(R=!0,g.u(xq,Xy(b.U,"musicAlbumRelease"),5)):g.u(xq,sH(b.U,V,"musicAlbumRelease"),4);case 4:(h=xq.L)&&G.push(h);xq.F8(3);break;case 5:G=xq.L;case 3:if((d=G)==null||!d.length)return xq.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));if(R){O=[];B=g.x(G);for(E=B.next();!E.done;E=B.next())F=E.value,p=g.lB(F.id).entityId,O.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
p,"musicAlbumRelease",0,mC));return xq.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,O))}M=[];y=G[0];S=void 0;if(!y.downloadMetadata){xq.F8(6);break}return g.u(xq,sH(b.U,y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:v=xq.L,S=Number((t=(K=v)==null?void 0:K.addedTimestampMillis)!=null?t:"0")/1E3;case 6:return g.Rq(xq,8),g.u(xq,HhT(b,Q,(r=S)==null?void 0:r.toString()),10);case 10:M=xq.L;g.h_(xq,9);break;case 8:k=g.dW(xq);if(!(k instanceof Error&&k.message===
"No data")){if(k instanceof Error&&k.message==="Empty response body")L9(k.message);else return n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G$="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.M$&&k.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G$="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xq.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,n,G$));xq.F8(9);break}return g.u(xq,WR(Q,"musicAlbumRelease",
b.U,L,b.B),9);case 9:L3=[];VJ=new Map;if((oY=M)==null?0:oY.length)for(Eo=g.x(M),qT=Eo.next();!qT.done;qT=Eo.next())S5=qT.value,f3=S5.offlineVideoData,Nu=void 0,((Nu=f3)==null?0:Nu.videoId)&&VJ.set(f3.videoId,f3);PJ=new Map;X2=[];if((Do=y)==null?0:(sT=Do.tracks)==null?0:sT.length)for(v8=g.x(y.tracks),z=v8.next();!z.done;z=v8.next())if(UT=z.value,Cy=g.lB(UT).entityId)VJ.has(Cy)?(PJ.set(Cy,VJ.get(Cy)),VJ.delete(Cy)):X2.push(Cy);Ky=Number(((hF=L.actionMetadata)==null?void 0:hF.priority)||0)+1;I=g.x(VJ.entries());
for(bh=I.next();!bh.done;bh=I.next())ws=bh.value,o$=g.x(ws),m5=o$.next().value,h3=o$.next().value,JF=m5,qu=h3,L3.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",JF,"musicTrack",Ky,mC,HR(L,qu)));H9=g.x(PJ.entries());for(H=H9.next();!H.done;H=H9.next())w=H.value,W=g.x(w),D=W.next().value,m=W.next().value,NT=D,f=m,L3.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",NT,"musicTrack",Ky,mC,HR(L,f)));Y=g.x(X2);for(c=Y.next();!c.done;c=Y.next())vJ=c.value,L3.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
vJ,"musicTrack",0,mC));return xq.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,L3))}})},KxR=function(b,L){var q,V;
return g.P(function(Q){switch(Q.U){case 1:return q=NA(L),g.Rq(Q,2),V=g.lB(L.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.u(Q,$x(b.U,L,b.B),5):g.u(Q,WR(V,"musicAlbumRelease",b.U,L,b.B),6);case 6:return g.u(Q,Es8(b.U,L.entityKey),5);case 5:g.h_(Q,3);break;case 2:return g.dW(Q),Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},HhT=function(b,L,q){var V,Q,G;
return g.P(function(R){switch(R.U){case 1:return g.u(R,TXb([L]),2);case 2:return V=R.L,g.u(R,ihq(b,V[0],q),3);case 3:return Q=R.L,G=FO(Q.thumbnailDetails),g.u(R,Z9(G),4);case 4:return R.return(V[0].videos)}})},ihq=function(b,L,q){var V,Q,G,R,h,d,O,B,E,F,p,M,y,S;
return g.P(function(v){if(v.U==1){V=L.additionalMetadadatas;Q=void 0;if(V&&V.length>0)for(G=g.x(V),R=G.next();!R.done;R=G.next())if(h=R.value,h.offlineMusicPlaylistData){Q=h.offlineMusicPlaylistData;break}d=L.playlistId;O=FOy(L);B=O.Gu;E=O.Ee;F=q?(Number(q)*1E3).toString():Date.now().toString();p=L.lastModifiedTimestamp?(Number(L.lastModifiedTimestamp)*1E3).toString():"0";M={id:g.A2(d,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:E,lastModifiedTimestampMillis:p,addedTimestampMillis:F,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};y={id:g.A2(d,"musicAlbumRelease"),title:L.title,audioPlaylistId:d,trackCount:L.totalVideoCount,tracks:B,downloadMetadata:M.id};Q&&(y.thumbnailDetails=(S=Q.albumHqThumbnail)!=null?S:Q.albumArtistThumbnail,y.artistDisplayName=Q.albumArtistDisplayName,y.releaseDate=Q.albumReleaseDate,y.contentRating={explicitType:Q.albumReleaseExplicitType},y.releaseType=Q.albumReleaseType);return g.u(v,CZ(b.U,{mode:"readwrite",qo:!0},function(K){var t=kU(K,y,"musicAlbumRelease");
K=kU(K,M,"musicAlbumReleaseDownloadMetadataEntity");return g.IX.all([t,K])}),2)}return v.return(y)})},v0W=function(b,L){this.U=b;
this.B=L},t7Q=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v;
return g.P(function(K){switch(K.U){case 1:return q=NA(L),V=g.lB(L.entityKey),Q=V.entityId,G=[],g.Rq(K,2),g.u(K,x9w(b,Q),4);case 4:G=K.L;if((R=G)==null||!R.length){K.F8(5);break}return g.u(K,BXy(b.U,L.entityKey),5);case 5:g.h_(K,3);break;case 2:return h=g.dW(K),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.M$&&h.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,d,O));case 3:return B=[],g.u(K,AdR(b.U,"musicTrack",G),7);case 7:G=K.L;if(G.length)for(E=g.x(G),F=E.next();!F.done;F=E.next())if(p=F.value,M=p.offlineVideoData,y=void 0,(y=M)==null?0:y.videoId)S=void 0,v=Number(((S=L.actionMetadata)==null?void 0:S.priority)||0)+1,B.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",v,s8,HR(L,M,Q)));return K.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,B))}})},
a2_=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT,v8,z,UT,Cy,hF,Ky,I,bh,ws,o$,m5,h3,JF,qu,H9,H,w,W,D,m,NT,f,Y,c,vJ,xq,Zo,K3,Qw,z$,nJ,a$,Xs,ih,kV,tF,SR;
return g.P(function(n3){switch(n3.U){case 1:return q=NA(L),V=L.entityKey,Q=g.lB(V).entityId,G=[],R=!1,Q==="!*$_ALL_ENTITIES_!*$"?(R=!0,g.u(n3,Xy(b.U,"musicPlaylist"),5)):g.u(n3,sH(b.U,V,"musicPlaylist"),4);case 4:(h=n3.L)&&G.push(h);n3.F8(3);break;case 5:G=n3.L;case 3:if((d=G)==null||!d.length)return n3.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));O=g.T(L.actionMetadata,pVb);E=(B=O)==null?void 0:B.autoSync;F=[];M=p=!0;y=!1;S=void 0;if(!R&&E===!1){n3.F8(6);break}g.Rq(n3,7);return g.u(n3,
WOb(0,!!E,!0,G),9);case 9:F=n3.L;g.h_(n3,8);break;case 7:v=g.dW(n3);if(!(v instanceof Error&&v.message==="No data")){v instanceof Error&&v.message==="Empty response body"&&L9(v.message);n3.F8(8);break}return Q==="!*$_ALL_ENTITIES_!*$"?g.u(n3,$x(b.U,L,b.B),8):g.u(n3,WR(Q,"musicPlaylist",b.U,L,b.B),8);case 8:if(!F.length||!R&&F[0].playlistId!==Q)return n3.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));case 6:if(R){K=[];t=g.x(F);for(r=t.next();!r.done;r=t.next())k=r.value,k.upToDate||
E&&!k.shouldAutoSyncMetadata||!k.playlistId||(n={autoSync:E},K.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k.playlistId,"musicPlaylist",0,s8,{musicPlaylistEntityActionMetadata:n})));return n3.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,K))}F.length&&(G$=F[0],y=!!G$.upToDate,E&&(p=(L3=G$.shouldAutoSyncMetadata)!=null?L3:!0,M=(VJ=G$.shouldAutoSyncVideos)!=null?VJ:!0,G$.checkInSeconds&&(S=G$.checkInSeconds)));if(y||!p)return n3.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));oY=[];Eo=G[0];qT=void 0;if(!Eo.downloadMetadata){n3.F8(15);break}return g.u(n3,sH(b.U,Eo.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:S5=n3.L,qT=Number((Nu=(f3=S5)==null?void 0:f3.addedTimestampMillis)!=null?Nu:"0")/1E3;case 15:return g.Rq(n3,17),g.u(n3,x9w(b,Q,(PJ=qT)==null?void 0:PJ.toString(),S),19);case 19:oY=n3.L;g.h_(n3,18);break;case 17:X2=g.dW(n3);if(!(X2 instanceof Error&&X2.message==="No data")){if(X2 instanceof Error&&X2.message==="Empty response body")L9(X2.message);
else return Do="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",sT="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X2 instanceof g.M$&&X2.type==="QUOTA_EXCEEDED"&&(Do="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",sT="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),n3.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,Do,sT));n3.F8(18);break}return g.u(n3,WR(Q,"musicPlaylist",b.U,L,b.B),18);case 18:if(!M)return n3.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));v8=[];z=new Map;if((UT=oY)==null?0:UT.length)for(Cy=g.x(oY),hF=Cy.next();!hF.done;hF=Cy.next())Ky=hF.value,I=Ky.offlineVideoData,bh=void 0,((bh=I)==null?0:bh.videoId)&&z.set(I.videoId,I);ws=new Map;o$=[];if((m5=Eo)==null?0:(h3=m5.tracks)==null?0:h3.length)for(JF=g.x(Eo.tracks),qu=JF.next();!qu.done;qu=JF.next())if(H9=qu.value,H=g.lB(H9).entityId)z.has(H)?(ws.set(H,z.get(H)),z.delete(H)):o$.push(H);W=Number(((w=L.actionMetadata)==null?void 0:w.priority)||0)+1;D=g.x(z.entries());for(m=D.next();!m.done;m=
D.next())NT=m.value,f=g.x(NT),Y=f.next().value,c=f.next().value,vJ=Y,xq=c,v8.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",vJ,"musicTrack",W,s8,HR(L,xq)));Zo=g.x(ws.entries());for(K3=Zo.next();!K3.done;K3=Zo.next())Qw=K3.value,z$=g.x(Qw),nJ=z$.next().value,a$=z$.next().value,Xs=nJ,ih=a$,v8.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Xs,"musicTrack",W,s8,HR(L,ih)));kV=g.x(o$);for(tF=kV.next();!tF.done;tF=kV.next())SR=tF.value,v8.push(iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",SR,"musicTrack",
0,s8));return n3.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,v8))}})},rIW=function(b,L){var q,V;
return g.P(function(Q){switch(Q.U){case 1:return q=NA(L),g.Rq(Q,2),V=g.lB(L.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.u(Q,$x(b.U,L,b.B),5):g.u(Q,WR(V,"musicPlaylist",b.U,L,b.B),6);case 6:return g.u(Q,Es8(b.U,L.entityKey),5);case 5:g.h_(Q,3);break;case 2:return g.dW(Q),Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},x9w=function(b,L,q,V){var Q,G,R;
return g.P(function(h){switch(h.U){case 1:return g.u(h,TXb([L]),2);case 2:return Q=h.L,g.u(h,D9T(b,Q[0],q,V),3);case 3:return G=h.L,R=FO(G.thumbnailDetails),g.u(h,Z9(R),4);case 4:return h.return(Q[0].videos)}})},D9T=function(b,L,q,V){var Q,G,R,h,d,O,B,E,F;
return g.P(function(p){return p.U==1?(Q=L.playlistId,G=FOy(L),R=G.Gu,h=G.Ee,d=q?(Number(q)*1E3).toString():Date.now().toString(),O=L.lastModifiedTimestamp?(Number(L.lastModifiedTimestamp)*1E3).toString():"0",B={id:g.A2(Q,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:h,lastModifiedTimestampMillis:O,addedTimestampMillis:d,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},E={id:g.A2(Q,"musicPlaylist"),title:L.title,playlistId:Q,thumbnailDetails:L.thumbnail,visibility:jhb(L),trackCount:L.totalVideoCount,
tracks:R,downloadMetadata:B.id},V&&(((F=E)==null?0:F.entityMetadata)?E.entityMetadata.nextAutoRefreshIntervalSeconds=String(V):E&&(E.entityMetadata={nextAutoRefreshIntervalSeconds:String(V)})),g.u(p,CZ(b.U,{mode:"readwrite",qo:!0},function(M){var y=kU(M,E,"musicPlaylist");M=kU(M,B,"musicPlaylistDownloadMetadataEntity");return g.IX.all([y,M])}),2)):p.return(E)})},jhb=function(b){switch(b.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},ub_=function(b,L){this.U=b;
this.B=L},kz_=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M;
return g.P(function(y){switch(y.U){case 1:return q=NA(L),V=g.lB(L.entityKey),Q=V.entityId,G=g.T(L.actionMetadata,cIw),g.Rq(y,2),g.u(y,PxQ(b,Q,void 0,(R=G)==null?void 0:R.track,(h=G)==null?void 0:h.albumRelease),4);case 4:if((d=G)==null?0:d.playlistId){y.F8(5);break}return g.u(y,BXy(b.U,L.entityKey),5);case 5:g.h_(y,3);break;case 2:return O=g.dW(y),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.M$&&O.type==="QUOTA_EXCEEDED"&&
(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,B,E));case 3:p=Number(((F=L.actionMetadata)==null?void 0:F.priority)||0)+1;var S=(S=g.T(L.actionMetadata,cIw))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;M=iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q,"playbackData",p,n0q,S);return y.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q,[M]))}})},l2w=function(b,L){var q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S;
return g.P(function(v){switch(v.U){case 1:return q=NA(L),V=g.lB(L.entityKey),Q=V.entityId,g.u(v,sH(b.U,L.entityKey,"musicTrack"),2);case 2:G=v.L;if(!G){R=void 0;v.F8(3);break}return g.u(v,sH(b.U,G.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:R=v.L;case 3:h=R;if(!G||!h)return v.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));O=g.T(L.actionMetadata,cIw);g.Rq(v,5);return g.u(v,PxQ(b,Q,h.addedTimestampMillis,(B=O)==null?void 0:B.track,(E=O)==null?void 0:E.albumRelease),
7);case 7:p=Number(((F=L.actionMetadata)==null?void 0:F.priority)||0)+1;d=iX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q,"playbackData",p,n0q);g.h_(v,6);break;case 5:M=g.dW(v);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")L9(M.message);else return y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.M$&&M.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,y,S));v.F8(6);break}return g.u(v,IT(Q,b.U,L,b.B),6);case 6:return v.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,d?[d]:void 0))}})},AIb=function(b,L){var q,V;
return g.P(function(Q){switch(Q.U){case 1:return q=NA(L),g.Rq(Q,2),V=g.lB(L.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.u(Q,$x(b.U,L,b.B),5):g.u(Q,IT(V,b.U,L,b.B),6);case 6:return g.u(Q,Es8(b.U,L.entityKey),5);case 5:g.h_(Q,3);break;case 2:return g.dW(Q),Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new vR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},PxQ=function(b,L,q,V,Q){var G,R,h,d,O,B;
return g.P(function(E){switch(E.U){case 1:if(G=V){E.F8(2);break}return g.u(E,eKb([L]),3);case 3:R=E.L,h=R[0],G=Om_(h);case 2:return g.u(E,Ye_(b,G,L,Q,q),4);case 4:d=E.L;O=d.musicTrackEntity;B=d.e6;var F=FO(O.thumbnailDetails),p=[];B&&(p=FO(B.thumbnailDetails));return g.u(E,Z9(F.concat(p)),0)}})},Ye_=function(b,L,q,V,Q){var G;
return g.P(function(R){return R.U==1?(Q||(Q=Date.now().toString()),G={id:g.A2(q,"musicTrackDownloadMetadataEntity"),playbackData:g.A2(q,"playbackData"),addedTimestampMillis:Q,videoDownloadContextEntity:g.A2(q,"videoDownloadContextEntity")},V&&(L.albumRelease=V.id),g.u(R,CZ(b.U,{mode:"readwrite",qo:!0},function(h){var d=[],O=kU(h,G,"musicTrackDownloadMetadataEntity");d.push(O);O=kU(h,L,"musicTrack");d.push(O);V&&(h=kU(h,V,"musicAlbumRelease"),d.push(h));return g.IX.all(d)}),2)):R.U!=3?g.u(R,O8(q,"musicTrackDownloadMetadataEntity",
b.U,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):R.return({musicTrackEntity:L,
e6:V})})},XO=function(){lX.apply(this,arguments);
this.Uo="musicTrack"},Cxb=function(b,L,q){L=L===void 0?43200:L;
q=q===void 0?!0:q;var V=V===void 0?!1:V;var Q,G;return g.P(function(R){switch(R.U){case 1:if(!b.J.ez())return R.return([]);Q=[];g.Rq(R,2);return g.u(R,WOb(L,q,V),4);case 4:Q=R.L;g.h_(R,3);break;case 2:g.dW(R);case 3:return G=U88(b,Q,q,"musicPlaylist"),R.return(G)}})},m9q=function(){g.Eg.apply(this,arguments);
var b=this;this.events=new g.OO(this);this.N=this.player.C();this.l$={t28:function(){return b.U},
Og:function(){return b.Og()},
Ht:function(L){return b.Ht(L)}}},sh8=function(b){var L;
b=g.T((L=b.getWatchNextResponse())==null?void 0:L.currentVideoEndpoint,g.O6);if(b==null?0:b.playlistId)var q=b.playlistId;return q},X2W=function(b,L){var q,V,Q,G;
return g.P(function(R){if(R.U==1){q=L.clientPlaybackNonce;V={cpn:q,offlineSourceVisualElement:g.eW(L.Ls||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};L.L&&(V.videoFmt=Number(L.L.itag));L.j&&(V.audioFmt=Number(L.j.itag));if((Q=sh8(L))&&L.videoId){var h=L.videoId;h=Q!=="PPSV"?Promise.resolve(!1):b.U.Ao(h);R=g.u(R,h,3)}else R=R.F8(2);return R}R.U!=2&&(G=R.L)&&(V.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");b.L=q;g.pB("offlinePlaybackStarted",V);g.GF(R)})};
g.tX.prototype.oA=g.uh(41,function(b){return this.app.oA(b)});
g.E0.prototype.oA=g.uh(40,function(b){return g.YF5(this,9,b)});
g.Z(a_,t0);g.AF.Object.defineProperties(a_.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.U.entityMetadata},
set:function(b){this.U.entityMetadata=b}}});
g.Z(Dmq,a_);Dmq.prototype.L=function(){return[]};
g.Z(jD_,a_);jD_.prototype.L=function(){return[]};
g.Z(u$W,a_);u$W.prototype.L=function(){return[]};
g.Z(cn_,a_);cn_.prototype.L=function(){return[]};
g.Z(P7T,a_);P7T.prototype.L=function(){return[]};
g.Z(n8_,a_);n8_.prototype.L=function(){var b=[];this.U.alternateChannel&&b.push(this.U.alternateChannel);this.U.alternateChannelList&&b.push.apply(b,g.a(this.U.alternateChannelList));this.U.oneofChannelEntity&&b.push(this.U.oneofChannelEntity);return[].concat(g.a(new Set(b)))};
g.Z(kJu,a_);kJu.prototype.L=function(){var b=[];this.U.entryCollection&&b.push(this.U.entryCollection);return[].concat(g.a(new Set(b)))};
g.Z(lXW,t0);lXW.prototype.L=function(){var b=[];this.U.video&&b.push(this.U.video);return[].concat(g.a(new Set(b)))};
g.Z(Anw,a_);Anw.prototype.L=function(){var b=[];this.U.parentPlaylist&&b.push(this.U.parentPlaylist);if(this.U.entries)for(var L=g.x(this.U.entries),q=L.next();!q.done;q=L.next())b.push.apply(b,g.a((new lXW(q.value)).L()));return[].concat(g.a(new Set(b)))};
g.Z(YG_,a_);YG_.prototype.L=function(){var b=[];this.U.descriptionEntity&&b.push(this.U.descriptionEntity);this.U.creators&&b.push.apply(b,g.a(this.U.creators));this.U.theBiggestFan&&b.push(this.U.theBiggestFan);return[].concat(g.a(new Set(b)))};
g.Z(C7b,a_);C7b.prototype.L=function(){return[]};
g.Z(mmR,a_);mmR.prototype.L=function(){return[]};
g.Z(sD_,a_);sD_.prototype.L=function(){return[]};
g.Z(X7Q,a_);X7Q.prototype.L=function(){return[]};
g.Z(fX_,a_);fX_.prototype.L=function(){return[]};
g.Z(JnQ,a_);JnQ.prototype.L=function(){return[]};
g.Z(Umq,a_);Umq.prototype.L=function(){return[]};
g.Z(bW8,a_);bW8.prototype.L=function(){return[]};
g.Z(LMT,a_);LMT.prototype.L=function(){return[]};
g.Z(q1R,a_);q1R.prototype.L=function(){var b=[];this.U.downloadsList&&b.push(this.U.downloadsList);this.U.smartDownloadsList&&b.push(this.U.smartDownloadsList);this.U.recommendedDownloadsList&&b.push(this.U.recommendedDownloadsList);this.U.refresh&&b.push(this.U.refresh);return[].concat(g.a(new Set(b)))};
g.Z(Vnu,t0);Vnu.prototype.L=function(){var b=[];this.U.video&&b.push(this.U.video);this.U.playlist&&b.push(this.U.playlist);this.U.videoItem&&b.push(this.U.videoItem);this.U.playlistItem&&b.push(this.U.playlistItem);return[].concat(g.a(new Set(b)))};
g.Z(Qrs,a_);Qrs.prototype.L=function(){var b=[];this.U.refresh&&b.push(this.U.refresh);if(this.U.downloads)for(var L=g.x(this.U.downloads),q=L.next();!q.done;q=L.next())b.push.apply(b,g.a((new Vnu(q.value)).L()));return[].concat(g.a(new Set(b)))};
g.Z(GaR,a_);GaR.prototype.L=function(){var b=[];this.U.localImageEntities&&b.push.apply(b,g.a(this.U.localImageEntities));return[].concat(g.a(new Set(b)))};
g.Z(RzT,a_);RzT.prototype.L=function(){var b=[];this.U.playbackData&&b.push(this.U.playbackData);this.U.localImageEntities&&b.push.apply(b,g.a(this.U.localImageEntities));this.U.videoDownloadContextEntity&&b.push(this.U.videoDownloadContextEntity);return[].concat(g.a(new Set(b)))};
g.Z(N88,a_);N88.prototype.L=function(){return[]};
g.Z(oJR,a_);oJR.prototype.L=function(){var b=[];this.U.fakeChildren&&b.push.apply(b,g.a(this.U.fakeChildren));return[].concat(g.a(new Set(b)))};
g.Z(hzw,a_);hzw.prototype.L=function(){var b=[];this.U.video&&b.push(this.U.video);this.U.playbackData&&b.push(this.U.playbackData);this.U.offlineVideoPolicy&&b.push(this.U.offlineVideoPolicy);return[].concat(g.a(new Set(b)))};
g.Z(dOw,a_);dOw.prototype.L=function(){return[]};
g.Z(OWy,a_);OWy.prototype.L=function(){var b=[];this.U.channelOwner&&b.push(this.U.channelOwner);this.U.videos&&b.push.apply(b,g.a(this.U.videos));this.U.collaboratorChannels&&b.push.apply(b,g.a(this.U.collaboratorChannels));this.U.downloadState&&b.push(this.U.downloadState);this.U.refresh&&b.push(this.U.refresh);return[].concat(g.a(new Set(b)))};
g.Z(B8u,a_);B8u.prototype.L=function(){var b=[];this.U.video&&b.push(this.U.video);this.U.channelContributor&&b.push(this.U.channelContributor);return[].concat(g.a(new Set(b)))};
g.Z(EJb,t0);EJb.prototype.L=function(){var b=[];this.U.localImageEntities&&b.push.apply(b,g.a(this.U.localImageEntities));this.U.videoDownloadContextEntity&&b.push(this.U.videoDownloadContextEntity);return[].concat(g.a(new Set(b)))};
g.Z(FMT,t0);FMT.prototype.L=function(){var b=[];this.U.recommendedVideoMetadata&&b.push.apply(b,g.a((new EJb(this.U.recommendedVideoMetadata)).L()));return[].concat(g.a(new Set(b)))};
g.Z(pvu,t0);pvu.prototype.L=function(){var b=[];this.U.playbackPosition&&b.push(this.U.playbackPosition);return[].concat(g.a(new Set(b)))};
g.Z(Mns,a_);Mns.prototype.L=function(){var b=[];this.U.owner&&b.push(this.U.owner);this.U.downloadState&&b.push(this.U.downloadState);this.U.userState&&b.push.apply(b,g.a((new pvu(this.U.userState)).L()));this.U.additionalMetadata&&b.push.apply(b,g.a((new FMT(this.U.additionalMetadata)).L()));return[].concat(g.a(new Set(b)))};
g.Z(ezT,a_);ezT.prototype.L=function(){var b=[];this.U.userChannelDetails&&b.push(this.U.userChannelDetails);return[].concat(g.a(new Set(b)))};
g.Z(T8s,a_);T8s.prototype.L=function(){var b=[];this.U.channelOwner&&b.push(this.U.channelOwner);this.U.playbackPosition&&b.push(this.U.playbackPosition);this.U.localImageEntities&&b.push.apply(b,g.a(this.U.localImageEntities));this.U.downloadStatus&&b.push(this.U.downloadStatus);return[].concat(g.a(new Set(b)))};
g.Z(ZWQ,a_);ZWQ.prototype.L=function(){return[]};
g.Z(yYW,a_);yYW.prototype.L=function(){return[]};
g.Z(wvs,a_);wvs.prototype.L=function(){return[]};
g.Z(S1b,a_);S1b.prototype.L=function(){return[]};
g.Z(IyT,a_);IyT.prototype.L=function(){return[]};
g.Z(WM8,a_);WM8.prototype.L=function(){return[]};
g.Z($O8,a_);$O8.prototype.L=function(){return[]};
g.Z(HWy,a_);HWy.prototype.L=function(){return[]};
g.Z(zz_,a_);zz_.prototype.L=function(){return[]};
g.Z(gJW,a_);gJW.prototype.L=function(){return[]};
g.Z(KMT,a_);KMT.prototype.L=function(){return[]};
g.Z(iWQ,a_);iWQ.prototype.L=function(){return[]};
g.Z(vJq,a_);vJq.prototype.L=function(){return[]};
g.Z(xO_,a_);xO_.prototype.L=function(){var b=[];this.U.compositeSourceKeys&&b.push.apply(b,g.a(this.U.compositeSourceKeys));return[].concat(g.a(new Set(b)))};
g.Z(tnW,a_);tnW.prototype.L=function(){var b=[];this.U.trackDownloadMetadatas&&b.push.apply(b,g.a(this.U.trackDownloadMetadatas));return[].concat(g.a(new Set(b)))};
g.Z(ay8,a_);
ay8.prototype.L=function(){var b=[];this.U.downloadedTracks&&b.push.apply(b,g.a(this.U.downloadedTracks));this.U.smartDownloadedTracks&&b.push.apply(b,g.a(this.U.smartDownloadedTracks));this.U.downloadedEpisodes&&b.push.apply(b,g.a(this.U.downloadedEpisodes));this.U.downloadedAlbumReleases&&b.push.apply(b,g.a(this.U.downloadedAlbumReleases));this.U.smartDownloadedAlbumReleases&&b.push.apply(b,g.a(this.U.smartDownloadedAlbumReleases));this.U.downloadedPlaylists&&b.push.apply(b,g.a(this.U.downloadedPlaylists));this.U.smartDownloadedPlaylists&&
b.push.apply(b,g.a(this.U.smartDownloadedPlaylists));this.U.metadataOnlyTracks&&b.push.apply(b,g.a(this.U.metadataOnlyTracks));return[].concat(g.a(new Set(b)))};
g.Z(rYW,a_);rYW.prototype.L=function(){var b=[];this.U.trackDownloadMetadatas&&b.push.apply(b,g.a(this.U.trackDownloadMetadatas));return[].concat(g.a(new Set(b)))};
g.Z(DOu,a_);DOu.prototype.L=function(){var b=[];this.U.playbackData&&b.push(this.U.playbackData);this.U.localImageEntities&&b.push.apply(b,g.a(this.U.localImageEntities));this.U.videoDownloadContextEntity&&b.push(this.U.videoDownloadContextEntity);return[].concat(g.a(new Set(b)))};
g.Z(jr_,a_);jr_.prototype.L=function(){var b=[];this.U.musicLibraryStatusEntity&&b.push(this.U.musicLibraryStatusEntity);this.U.primaryArtists&&b.push.apply(b,g.a(this.U.primaryArtists));this.U.details&&b.push(this.U.details);this.U.userDetails&&b.push(this.U.userDetails);this.U.tracks&&b.push.apply(b,g.a(this.U.tracks));this.U.share&&b.push(this.U.share);this.U.downloadMetadata&&b.push(this.U.downloadMetadata);this.U.refresh&&b.push(this.U.refresh);return[].concat(g.a(new Set(b)))};
g.Z(uiw,a_);uiw.prototype.L=function(){var b=[];this.U.albumRelease&&b.push(this.U.albumRelease);this.U.tracks&&b.push.apply(b,g.a(this.U.tracks));return[].concat(g.a(new Set(b)))};
g.Z(cYu,a_);cYu.prototype.L=function(){var b=[];this.U.albumRelease&&b.push(this.U.albumRelease);return[].concat(g.a(new Set(b)))};
g.Z(PlF,a_);PlF.prototype.L=function(){var b=[];this.U.details&&b.push(this.U.details);this.U.userDetails&&b.push(this.U.userDetails);return[].concat(g.a(new Set(b)))};
g.Z(nJ_,a_);nJ_.prototype.L=function(){var b=[];this.U.parentArtist&&b.push(this.U.parentArtist);return[].concat(g.a(new Set(b)))};
g.Z(ka_,a_);ka_.prototype.L=function(){var b=[];this.U.parentArtist&&b.push(this.U.parentArtist);return[].concat(g.a(new Set(b)))};
g.Z(ly_,a_);ly_.prototype.L=function(){return[]};
g.Z(AYq,a_);AYq.prototype.L=function(){return[]};
g.Z(Y1R,t0);Y1R.prototype.L=function(){var b=[];this.U.creatorEntity&&b.push(this.U.creatorEntity);return[].concat(g.a(new Set(b)))};
g.Z(ClW,a_);
ClW.prototype.L=function(){var b=[];this.U.tracks&&b.push.apply(b,g.a(this.U.tracks));this.U.refresh&&b.push(this.U.refresh);this.U.musicLibraryStatusEntity&&b.push(this.U.musicLibraryStatusEntity);this.U.details&&b.push(this.U.details);this.U.downloadMetadata&&b.push(this.U.downloadMetadata);this.U.sideloadMetadata&&b.push(this.U.sideloadMetadata);this.U.userDetails&&b.push(this.U.userDetails);this.U.entryCollection&&b.push(this.U.entryCollection);this.U.share&&b.push(this.U.share);this.U.podcastShowAdditionalMetadata&&b.push.apply(b,
g.a((new Y1R(this.U.podcastShowAdditionalMetadata)).L()));return[].concat(g.a(new Set(b)))};
g.Z(mOy,a_);mOy.prototype.L=function(){return[]};
g.Z(sr_,a_);
sr_.prototype.L=function(){var b=[];this.U.musicLibraryStatusEntity&&b.push(this.U.musicLibraryStatusEntity);this.U.artists&&b.push.apply(b,g.a(this.U.artists));this.U.audioModeVersion&&b.push(this.U.audioModeVersion);this.U.videoModeVersion&&b.push(this.U.videoModeVersion);this.U.userDetails&&b.push(this.U.userDetails);this.U.details&&b.push(this.U.details);this.U.albumRelease&&b.push(this.U.albumRelease);this.U.share&&b.push(this.U.share);this.U.libraryEdit&&b.push(this.U.libraryEdit);this.U.downloadMetadata&&
b.push(this.U.downloadMetadata);this.U.playbackPosition&&b.push(this.U.playbackPosition);this.U.lyrics&&b.push(this.U.lyrics);return[].concat(g.a(new Set(b)))};
g.Z(Xvb,a_);Xvb.prototype.L=function(){var b=[];this.U.parentTrack&&b.push(this.U.parentTrack);return[].concat(g.a(new Set(b)))};
g.Z(fyR,a_);fyR.prototype.L=function(){var b=[];this.U.parentTrack&&b.push(this.U.parentTrack);return[].concat(g.a(new Set(b)))};
g.Z(JYF,a_);JYF.prototype.L=function(){return[]};
g.Z(UO_,a_);UO_.prototype.L=function(){return[]};
g.Z(bDq,a_);bDq.prototype.L=function(){return[]};
g.Z(LW_,a_);LW_.prototype.L=function(){return[]};
g.Z(qbq,a_);qbq.prototype.L=function(){var b=[];this.U.transfer&&b.push(this.U.transfer);this.U.adsPlaybackData&&b.push.apply(b,g.a(this.U.adsPlaybackData));this.U.drmLicense&&b.push(this.U.drmLicense);this.U.offlineVideoPolicy&&b.push(this.U.offlineVideoPolicy);this.U.videoDownloadContextEntity&&b.push(this.U.videoDownloadContextEntity);return[].concat(g.a(new Set(b)))};
g.Z(VxF,a_);VxF.prototype.L=function(){return[]};
g.Z(Q7_,a_);Q7_.prototype.L=function(){var b=[];this.U.offlineVideoStreams&&b.push.apply(b,g.a(this.U.offlineVideoStreams));this.U.captionTrack&&b.push.apply(b,g.a(this.U.captionTrack));return[].concat(g.a(new Set(b)))};
g.Z(GsR,a_);GsR.prototype.L=function(){return[]};
g.Z(R4u,a_);R4u.prototype.L=function(){return[]};
g.Z(NA_,a_);NA_.prototype.L=function(){return[]};
g.Z(oQ_,a_);oQ_.prototype.L=function(){return[]};
g.Z(h4w,a_);h4w.prototype.L=function(){return[]};
g.Z(diR,a_);diR.prototype.L=function(){return[]};
g.Z(ODq,a_);ODq.prototype.L=function(){return[]};
g.Z(BAR,a_);BAR.prototype.L=function(){return[]};
g.Z(EQb,a_);EQb.prototype.L=function(){return[]};
g.Z(FW8,a_);FW8.prototype.L=function(){return[]};
g.Z(pj8,a_);pj8.prototype.L=function(){return[]};
g.Z(MxQ,a_);MxQ.prototype.L=function(){return[]};
g.Z(e4T,a_);e4T.prototype.L=function(){return[]};
g.Z(TAW,a_);TAW.prototype.L=function(){return[]};
g.Z(ZDb,a_);ZDb.prototype.L=function(){return[]};
g.Z(yT_,a_);yT_.prototype.L=function(){return[]};
g.Z(wjb,a_);wjb.prototype.L=function(){return[]};
g.Z(SbW,a_);SbW.prototype.L=function(){return[]};
g.Z(Itu,a_);Itu.prototype.L=function(){return[]};
g.Z(WWW,a_);WWW.prototype.L=function(){return[]};
g.Z($iq,a_);$iq.prototype.L=function(){return[]};
g.Z(HDs,a_);HDs.prototype.L=function(){return[]};
var $Qq=["browse","music/browse","streaming_browse","unplugged/browse"],imW=["offline/playlist_sync_check"],Mmq=["offline"],HmQ=["offline/offline_video_playback_position_sync"],gsQ=["offline/get_playback_data_entity"],rI;Df.getInstance=function(){return g.P(function(b){return b.return(new Promise(function(L){g.L5().then(function(q){q?(Df.instance||(Df.instance=new Df(q)),L(Df.instance)):L(void 0)})}))})};
Df.prototype.get=function(b){var L=this,q,V,Q;return g.P(function(G){if(G.U==1)return g.u(G,iDQ(L.token),2);if(G.U!=3)return q=G.L,g.u(G,q.get("prefs",b),3);V=G.L;if(!V)return G.return();Q=(0,g.zl)();return V.expirationTimestampMs<=Q?G.return():G.return(V.value)})};
Df.prototype.set=function(b,L,q){q=q===void 0?31536E3:q;var V=this,Q,G,R;return g.P(function(h){if(h.U==1)return Q=(0,g.zl)(),G={key:b,value:L,expirationTimestampMs:Q+q*1E3},g.u(h,iDQ(V.token),2);R=h.L;return g.u(h,g.aX(R,"prefs",G),0)})};
Df.prototype.remove=function(b){var L=this,q;return g.P(function(V){if(V.U==1)return g.u(V,iDQ(L.token),2);q=V.L;return g.u(V,q.delete("prefs",b),0)})};
g.Z(jG,g.dU);g.Z(uP,rTw);uP.prototype.B=function(b,L){L=j7w(L);b=(new TextEncoder).encode(JSON.stringify(b));return this.U.encrypt(b,L)};
uP.prototype.L=function(b,L){if(!(b instanceof Uint8Array))throw vQq(1);var q=new TextDecoder;L=j7w(L);b=this.U.decrypt(b,L);return JSON.parse(q.decode(b))};
var uET={accountLinkStatusEntity:sD_,booleanEntity:cn_,buttonEntity:ZDb,captionTrack:JYF,channelHandle:Dmq,chipEntity:ODq,commerceAcquisitionClientPayloadEntity:wjb,commerceCartListEntity:SbW,compositeSourceEntity:vJq,multiviewStagingEntity:xO_,contextNoteFeedEntityPayload:jD_,contextNoteUserRatingEntityPayload:u$W,continuationTokenEntity:dOw,downloadQualityPickerEntity:Umq,downloadsPageRefreshTokenEntity:LMT,downloadsPageViewConfigurationEntity:ZWQ,downloadStatusEntity:bW8,dismissState:BAR,sfvAudioItemCurrentlyPlayingEntity:oQ_,
emojiFountainDataEntity:e4T,emojiCustomizationSetEntity:MxQ,fakeChannel:n8_,fakePlaylist:kJu,fakePlaylistEntryCollection:Anw,fakeVideo:YG_,fakeVideoDescription:C7b,featuredProductsEntity:gJW,flowStateEntity:mmR,iconBadgeEntity:Itu,interstitialInteractionStateEntity:fX_,likeButtonAnimationEntity:yYW,liveChatPollStateEntity:JnQ,dataFreshnessEntity:pj8,liveViewerLeaderboardChatEntryPointStateEntity:R4u,liveViewerLeaderboardPointsEntity:NA_,liveReactionsDataEntity:TAW,logoEntity:X7Q,macroMarkerEntity:wvs,
mainDownloadsLibraryEntity:q1R,mainDownloadsListEntity:Qrs,mainPlaylistDownloadStateEntity:GaR,mainPlaylistEntity:OWy,mainPlaylistVideoEntity:B8u,mainVideoDownloadStateEntity:RzT,mainVideoEntity:Mns,markersEngagementPanelSyncEntity:S1b,markersVisibilityOverrideEntity:IyT,musicAlbumReleaseDetail:uiw,musicAlbumReleaseDownloadMetadataEntity:tnW,musicAlbumRelease:jr_,musicAlbumReleaseUserDetail:cYu,musicArtistDetail:nJ_,musicArtist:PlF,musicArtistUserDetail:ka_,musicDownloadsLibraryEntity:ay8,musicLibraryEdit:ly_,
musicLibraryStatusEntity:AYq,musicPlaylist:ClW,musicPlaylistDownloadMetadataEntity:rYW,musicShare:mOy,musicTrackDetail:Xvb,musicTrackDownloadMetadataEntity:DOu,musicTrack:sr_,musicTrackUserDetail:fyR,offlineOrchestrationActionWrapperEntity:UO_,offlineVideoPolicy:bDq,offlineVideoStreams:LW_,offlineabilityEntity:N88,orchestrationWebSamplingEntity:oJR,pageHeaderEntity:EQb,pdpStateEntity:WWW,pinnedProductEntity:KMT,playbackData:qbq,playerStateEntity:WM8,quantityIncrementerEntity:$iq,refresh:VxF,saveToPlaylistListEntity:h4w,
selectedChipIndexEntityPayload:$O8,settingEntity:diR,stringEntity:P7T,suggestedFeedbackChipStateEntity:HWy,transfer:Q7_,trendingOfferEntity:iWQ,videoDownloadContextEntity:GsR,videoOverviewAsyncDataEntity:HDs,videoPlaybackPositionEntity:yT_,votingEntity:FW8,ytMainChannelEntity:ezT,youchatPendingResponseEntity:zz_,ytMainDownloadedVideoEntity:hzw,ytMainVideoEntity:T8s};g.Z(A0,rTw);A0.prototype.B=function(b){return b};
A0.prototype.L=function(b){if(b instanceof Uint8Array)throw vQq(0);return b};
g.Z(YU,g.l);YU.prototype.observe=function(b){var L=this;this.observers.push(b);return function(){var q=L.observers.indexOf(b);q>=0&&L.observers.splice(q,1)}};
YU.prototype.L=function(b){UiT(this,b.data)};
YU.prototype.jP=function(){this.channel.close()};
var QQ_,qiq=new g.t5("elementsCommand");var wK=new g.t5("entityBatchUpdate");var lp_=new g.t5("downloadStatusEntity");var Gzs=new g.t5("mainPlaylistEntityActionMetadata");var C9=new g.t5("mainVideoEntityActionMetadata");var pVb=new g.t5("musicPlaylistEntityActionMetadata");var cIw=new g.t5("musicTrackEntityActionMetadata");var yIW=new g.t5("localImageEntityActionMetadata");var xx=new g.t5("playbackDataActionMetadata");var qmw=new g.t5("transferEntityActionMetadata");var nsF=new g.t5("videoPlaybackPositionEntityActionMetadata");var ZHF;new g.Oe;new g.Oe;Wh8.prototype.request=function(b,L,q){L=L===void 0?{}:L;return this.locks.request(b,L,function(V){return q(V)})};var bX=g.wW.caches,UH,Kh_;J0.prototype.open=function(b){return bX.open(zh_(b))};
J0.prototype.has=function(b){return bX.has(zh_(b))};
J0.prototype.delete=function(b){return bX.delete(zh_(b))};
J0.prototype.match=function(b,L){var q=this,V,Q,G,R,h,d;return g.P(function(O){switch(O.U){case 1:return g.u(O,q.keys(),2);case 2:V=O.L,Q=g.x(V),G=Q.next();case 3:if(G.done){O.F8(5);break}R=G.value;return g.u(O,q.open(R),6);case 6:return h=O.L,g.u(O,h.match(b,L),7);case 7:if(d=O.L)return O.return(d);G=Q.next();O.F8(3);break;case 5:return O.return()}})};
g.Z(HHF,J0);HHF.prototype.keys=function(){var b,L,q,V,Q,G,R,h,d;return g.P(function(O){if(O.U==1)return b=[],L=g.fw("CacheStorage keys"),g.u(O,bX.keys(),2);q=O.L;V=g.x(q);for(Q=V.next();!Q.done;Q=V.next()){G=Q.value;var B=G.indexOf(":");R=B===-1?{nY:G}:{nY:G.substring(0,B),datasyncId:G.substring(B+1)};h=R.nY;d=R.datasyncId;d===L&&b.push(h)}return O.return(b)})};g.Z(qA,g.l);qA.prototype.B=function(b){this.api.vx("onOfflineOperationFailure",b.data)};
qA.prototype.j=function(b){this.api.publish("offlinetransferpause",b.data)};
qA.prototype.jP=function(){var b;(b=this.U)==null||b.close();var L;(L=this.L)==null||L.close()};xFq.prototype.Fu=function(){this.U&&QN(this)};
xFq.prototype.Rq=function(){this.L&&this.L.resolve();this.B=this.U=!1;this.Uo()};var TFW=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var UFs="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var dQ8="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.Z(xQT,K9);xQT.prototype.L=function(b){return oT(b)?roW(this,b):hV(b)?u_y(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};g.Z(co8,K9);co8.prototype.L=function(b){return hV(b)?Pf_(this,b):kuq(b)?kSw(this,b):dK(b)?lS_(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};g.e=Aoy.prototype;g.e.eZs=function(b){var L=this,q,V,Q,G;return g.P(function(R){if(!g.X(b.state,128))return R.F8(0);q=b.state.iT;var h=(V=q)==null?void 0:V.errorCode,d=(Q=q)==null?void 0:Q.j8;G=h==="net.connect"&&d===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(h==null?0:h.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.u(R,L.sA(L.player.getVideoData().videoId,G),0)})};
g.e.sA=function(b,L){var q=this;return g.P(function(V){if(V.U==1){if(q.L)return V.return();q.L=!0;return L==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(rK(q,b,!1,!0),V.F8(0)):g.u(V,aT(q,b),3)}g.Au(b,4);return g.u(V,q.U.sA(L),0)})};
g.e.D0=function(b){b.status===2?(b.status!==this.B&&(csW(this.U),g.Au(b.videoId,2)),b.jA&&AsR(this.U,b.videoId,b.jA)):b.status===4?(aT(this,b.videoId),this.sA(b.videoId,b.rP?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):b.status===1&&lKW(this.U);this.B=b.status;this.api.vx("localmediachange",{videoId:b.videoId,status:b.status})};
g.e.c_=function(){var b=this,L;return g.P(function(q){if(q.U==1){if(b.L)return q.return();b.L=!0;L=b.player.getVideoData().videoId;return g.u(q,aT(b,L),2)}return g.u(q,b.U.c_(),0)})};
g.e.KD=function(b){switch(b){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.e.T=function(b){return this.api.C().T(b)};g.Z(fSW,K9);fSW.prototype.L=function(b){return oT(b)?UQu(this,b):hV(b)?beW(this,b):kuq(b)?L3q(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};NFR.prototype.U=function(b,L){var q=b.action.actionMetadata.priority-L.action.actionMetadata.priority;q===0&&(b.U<L.U?q=-1:b.U>L.U&&(q=1));return q};g.Z(D9,g.l);D9.prototype.jP=function(){this.Uo&&this.Uo();g.l.prototype.jP.call(this)};
D9.prototype.createAction=function(b,L){var q=g.lB(b.entityKey).entityType,V=g.eb(16);return new p9(q,V,b,L.actionId,L.rootActionId)};
D9.prototype.yc=function(b){var L=this,q,V,Q,G,R,h,d,O,B;return g.P(function(E){if(E.U==1){if(L.RD())return E.return();V=(q=b.offlineOrchestrationActionWrapperEntity)!=null?q:new Set;Q=[];G=g.x(V);for(R=G.next();!R.done;R=G.next())h=R.value,d=g.lB(h),O=d.entityId,d8_(L.U,O)||Q.push(h);return g.u(E,wHq(L,Q),2)}B=E.L;return g.u(E,ysq(L,B),0)})};
D9.prototype.retry=function(){var b=this;return g.P(function(L){return g.u(L,Smb(b),0)})};W38.prototype.Pn=function(b,L){L=L===void 0?!0:L;var q=this,V,Q,G,R,h,d,O,B;return g.P(function(E){switch(E.U){case 1:if(!q.U)return E.return();V=[];Q=g.CE(q.U.U,L);G=[];for(R={Ne:0};R.Ne<Q.length;R={Ne:R.Ne},R.Ne++)h=Q[R.Ne],d=q.U.RM(h,"json3"),O=g.DH(d,{withCredentials:!0,format:"RAW"},3,500).then(function(F){return function(p){p={metadata:g.z9(Q[F.Ne]),trackData:p.xhr.responseText};G.push(p)}}(R)).UK(function(F){L9("Caption fetch error",F)}),V.push(O);
return g.u(E,rnT(V),2);case 2:return g.Rq(E,3),g.u(E,Bvy(b,G),5);case 5:g.h_(E,0);break;case 3:B=g.dW(E),L9("Caption DB transaction error",B),g.GF(E)}})};g.Z(j4,g.l);j4.prototype.jP=function(){this.L&&this.L();g.l.prototype.jP.call(this)};
j4.prototype.B=function(b){var L=this,q,V,Q,G,R,h,d,O;return g.P(function(B){V=(q=b.transfer)!=null?q:new Set;Q=[];G=g.x(V);for(R=G.next();!R.done;R=G.next())h=R.value,d=g.lB(h),O=d.entityId,Q.push(O);return Q.length===0?B.return():g.u(B,zjW(L,Q),0)})};g.Z(x8w,g.l);g.e=x8w.prototype;g.e.jP=function(){this.Dr&&this.Dr();this.eP.dispose();this.j.dispose();this.Hx&&g.Rv(this.J.Z8,this.Hx);this.Qc&&g.Rv(this.J.Z8,this.Qc);g.l.prototype.jP.call(this)};
g.e.B9v=function(b){var L=this,q,V,Q;return g.P(function(G){switch(G.U){case 1:q=g.A2(b,"transfer");if(L.U&&q===L.U.key){rK(L.Y,L.X,!0);L.j.stop();G.F8(0);break}return g.u(G,CZ(L.L,{mode:"readwrite",qo:!0},function(R){return cX(R,q,"transfer").then(function(h){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!=="TRANSFER_STATE_FAILED")return h.transferState="TRANSFER_STATE_PAUSED_BY_USER",kU(R,h,"transfer").then(function(){return h})})}),3);
case 3:V=G.L;if(!V){G.F8(0);break}if(!b||!L.B){G.F8(5);break}return g.u(G,O8(b,L.B,L.L,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.u(G,PR(L,b),7);case 7:Q=G.L,PVT({videoId:b,Ef:V,offlineModeType:Q}),g.GF(G)}})};
g.e.LZv=function(){var b=this;if(this.U&&this.X){rK(this.Y,this.X,!1);var L=this.U,q=(L==null?0:L.key)?g.lB(L.key).entityId:"";q&&this.B&&(new Promise(function(V,Q){O8(q,b.B,b.L,"DOWNLOAD_STATE_PAUSED").catch(function(G){Q(G)})})).catch(function(V){L9("Download state setting error",V)})}this.j.stop()};
g.e.wy=function(){this.U?rsT(this,this.U):cR(this)};
g.e.g5=function(b){var L=this;return g.P(function(q){switch(q.U){case 1:if(!L.U){q.F8(2);break}if(L.U.transferState==="TRANSFER_STATE_COMPLETE"||L.U.transferState==="TRANSFER_STATE_FAILED"||!b.transfer||!b.transfer.has(L.U.key)){q.F8(3);break}return g.u(q,sH(L.L,L.U.key,"transfer"),4);case 4:L.U=q.L;if(L.U){q.F8(3);break}return g.u(q,D8_(L),3);case 3:if(L.U)return q.return();case 2:return g.u(q,cR(L),0)}})};
g.e.sA=function(b,L){var q=this,V,Q,G,R,h;return g.P(function(d){switch(d.U){case 1:if(!q.U){n9(q,"onTransferFailure: "+b);d.F8(2);break}V=q.U;G=((Q=V)==null?0:Q.key)?g.lB(V.key).entityId:"";a:switch(b){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var O=!1;break a;default:O=!0}return O&&Ymq(q)?g.u(d,kx(q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.u(d,
CW_(q,b),5);case 5:if(!G||!q.B){d.F8(2);break}return g.u(d,O8(G,q.B,q.L,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.u(d,PR(q,G),9);case 9:R=d.L;RT({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:G,Ef:V,offlineModeType:R});if(!G||!q.B){d.F8(2);break}return g.u(d,O8(G,q.B,q.L,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:uX(q),h=cR(q,!0),L&&L(h),g.GF(d)}})};
g.e.c_=function(b){var L=this,q,V,Q,G,R,h,d,O,B,E,F,p;return g.P(function(M){switch(M.U){case 1:if(!L.U){n9(L,"onMaybeTransferStreamsExpired");M.F8(2);break}return Ymq(L)?g.u(M,kx(L,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.u(M,CW_(L,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!L.B){M.F8(2);break}q=L.U;Q=((V=q)==null?0:V.key)?g.lB(q.key).entityId:"";if(!Q){M.F8(2);break}return g.u(M,O8(Q,L.B,L.L,"DOWNLOAD_STATE_FAILED"),2);case 9:return L.U||n9(L,"onMaybeTransferStreamsExpiredRetryAttempting"),
G=L.U,h=((R=G)==null?0:R.key)?g.lB(G.key).entityId:"",g.u(M,PR(L,h),10);case 10:return d=M.L,RT({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:h,Ef:G,offlineModeType:d}),O=CV8(),g.DQ(O,xx,{isEnqueuedForExpiredStreamUrlRefetch:!0}),B=g.A2(h,"playbackData"),E={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:B,actionMetadata:O},F=e4(new p9("playbackData",h,E)),g.u(M,mK(L.L,F,"offlineOrchestrationActionWrapperEntity"),2);case 2:uX(L),p=cR(L,!0),
b&&b(p),g.GF(M)}})};
var f2w={},m8y=(f2w.TRANSFER_STATE_TRANSFERRING=1,f2w.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,f2w);g.e=lX.prototype;g.e.Zo=function(){return this.X.promise};
g.e.S4=function(){if(this.L&&this.Y)return this.X.promise;fKu(this).then(this.X.resolve).catch(this.X.reject);return this.X.promise};
g.e.mu=function(b){var L={};return L.playbackData=new xQT(b,this.N,this.U),L.transfer=new fSW(b,this.N),L.videoPlaybackPositionEntity=new co8(b,this.N),L};
g.e.Bf=function(){var b=this;return g.P(function(L){return b.L?g.u(L,tO8(b.L),0):L.F8(0)})};
g.e.VS=function(){var b=this,L,q;return g.P(function(V){if(V.U==1)return b.L||b.Y?g.u(V,b.Zo(),2):V.return();b.V!==void 0&&(g.IU(b.V),b.V=void 0);b.j!==void 0&&(g.IU(b.j),b.j=void 0);(L=b.L)==null||L.dispose();b.L=void 0;(q=b.Y)==null||q.dispose();b.Y=void 0;b.api.vx("onOrchestrationLostLeader");b.X=new g.Oe;g.GF(V)})};
g.e.isOrchestrationLeader=function(){return this.B.U};
g.e.Ao=function(){return g.P(function(b){return b.return(!1)})};
g.e.Dd=function(b){var L=this.U;L.api.publish("offlinetransferpause",b);var q;(q=L.L)==null||q.postMessage(b)};
g.e.wy=function(b){var L,q;return g.P(function(V){if(V.U==1)return g.u(V,fZ(),2);L=V.L;if(!L)return V.return();q=g.A2(b,"transfer");return g.u(V,CZ(L,{mode:"readwrite",qo:!0},function(Q){var G=cX(Q,q,"transfer"),R=cX(Q,g.A2(b,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.IX.all([G,R]).then(function(h){h=g.x(h);var d=h.next().value;var O=h.next().value;return d&&d.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",kU(Q,d,"transfer").then(function(){RT({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:b,Ef:d,offlineModeType:O==null?void 0:O.offlineModeType});return g.IX.resolve(null)})):g.IX.resolve(null)})}),0)})};
g.e.Y8=function(b){b=b===void 0?43200:b;var L=this,q,V,Q,G,R,h,d,O;return g.P(function(B){if(B.U==1)return L.J.ez()?g.u(B,fZ(),2):B.return(Jsw());if(B.U!=3){q=B.L;if(!q)return B.return([]);V=Date.now()/1E3;return g.u(B,Xy(q,"offlineVideoPolicy"),3)}Q=B.L;G=[];R=g.x(Q);for(h=R.next();!h.done;h=R.next())d=h.value,Number(d.lastUpdatedTimestampSeconds)+b<=V&&(O=g.lB(d.key).entityId,G.push(O));return G.length?B.return(AV(L,G,L.Uo,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):B.return([])})};
g.e.deleteAll=function(){return AV(this,["!*$_ALL_ENTITIES_!*$"],this.Uo,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.e.refreshAllStaleEntities=function(b){var L=this;return g.P(function(q){return q.U==1?g.u(q,L.Y8(b),2):q.return(q.L)})};
g.e.setUpPositionSyncInterval=function(b){var L=this;this.j!==void 0&&(g.IU(this.j),this.j=void 0);var q=b!=null?b:864E5;this.j=g.wm(function(){L.PA(q)},q)};
g.e.PA=function(b){var L=this,q,V,Q,G,R,h;return g.P(function(d){switch(d.U){case 1:return g.Rq(d,2),g.u(d,Df.getInstance(),4);case 4:q=d.L;if(!q)throw Error("prefStorage is undefined");return g.u(d,q.get("psi"),5);case 5:V=d.L;G=((Q=V)==null?0:Q.J8)?Number(V.J8)/1E3:0;R=Date.now();if(!(G+b<=R)){d.F8(6);break}return g.u(d,AV(L,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.h_(d,0);break;case 2:h=g.dW(d),L9("Offline manager error",h),
g.GF(d)}})};
g.e.h1=function(){var b=this,L,q,V,Q,G,R,h;return g.P(function(d){if(d.U==1)return g.u(d,fZ(),2);if(d.U!=3)return(L=d.L)?g.u(d,Xy(L,"transfer"),3):d.return([]);q=d.L;V=[];Q=g.x(q);for(G=Q.next();!G.done;G=Q.next())R=G.value,R.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&R.key&&(h=g.lB(R.key).entityId,V.push(h));return d.return(bhW(b,V))})};
g.e.cG=function(){return g.P(function(b){return b.return([])})};
g.e.Gi=function(){return g.P(function(b){g.GF(b)})};
g.e.Qm=function(){return g.P(function(b){g.GF(b)})};g.Z(Lxu,K9);Lxu.prototype.L=function(b){return oT(b)?QhT(this,b):hV(b)?Ry_(this,b):dK(b)?Nn_(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};
var Yx=[10];g.Z(Bn_,K9);Bn_.prototype.L=function(b){return oT(b)?p2w(this,b):hV(b)?M7y(this,b):dK(b)?eyw(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};
var FxW=[10];g.Z(Zhy,K9);Zhy.prototype.L=function(b){return hV(b)?w2_(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};g.Z(SeW,lX);g.e=SeW.prototype;g.e.mu=function(b){var L=lX.prototype.mu.call(this,b);L.mainVideoEntity=new Bn_(b,this.N,this.U);L.mainPlaylistEntity=new Lxu(b,this.N,this.U);L.mainDownloadsListEntity=new Zhy(b,this.N,this.U);return L};
g.e.refreshAllStaleEntities=function(b,L){var q=this,V,Q,G,R,h,d,O,B,E,F,p;return g.P(function(M){switch(M.U){case 1:V=[];if(!q.N.T("web_player_offline_playlist_auto_refresh")){M.F8(2);break}return g.u(M,I28(q,b,L),3);case 3:V=M.L;case 2:return g.u(M,Df.getInstance(),4);case 4:return Q=M.L,g.u(M,(G=Q)==null?void 0:G.get("sdois"),5);case 5:return R=M.L,g.u(M,(h=Q)==null?void 0:h.get("lmqf"),6);case 6:d=M.L;if(!R){M.F8(7);break}B=V;E=B.concat;return g.u(M,Wxs(q,R,(O=d)!=null?O:"SD",b===0),8);case 8:V=
E.call(B,M.L);case 7:return F=V,p=F.concat,g.u(M,lX.prototype.refreshAllStaleEntities.call(q,b,L),9);case 9:return V=p.call(F,M.L),M.return(V)}})};
g.e.Ao=function(b){var L,q,V,Q,G,R,h,d;return g.P(function(O){if(O.U==1)return g.u(O,fZ(),2);if(O.U!=3)return(L=O.L)?g.u(O,sH(L,g.xv,"mainDownloadsListEntity"),3):O.return(!1);q=O.L;if((V=q)==null?0:(Q=V.downloads)==null?0:Q.length)for(G=g.A2(b,"mainVideoEntity"),R=g.x(q.downloads),h=R.next();!h.done;h=R.next())if(d=h.value,d.videoItem===G)return O.return(!0);return O.return(!1)})};
g.e.cG=function(){var b=this,L,q,V,Q,G,R,h,d;return g.P(function(O){if(O.U==1)return g.u(O,fZ(),2);if(O.U!=3)return(L=O.L)?g.u(O,Xy(L,"downloadStatusEntity"),3):O.return([]);q=O.L;V=[];Q=g.x(q);for(G=Q.next();!G.done;G=Q.next())R=G.value,R.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&R.key&&(h=g.lB(R.key).entityId,V.push(h));return V.length?(d={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},O.return(AV(b,V,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
d))):O.return([])})};
g.e.Qm=function(){var b;return g.P(function(L){return L.U==1?g.u(L,fZ(),2):(b=L.L)?g.u(L,CZ(b,{mode:"readwrite",qo:!0},function(q){return PX(q,"mainVideoEntity").then(function(V){var Q=[];V=g.x(V);for(var G=V.next();!G.done;G=V.next()){G=G.value;var R=void 0;(R=G.userState)!=null&&R.playbackPosition||(R=g.lB(G.key).entityId,R={key:g.A2(R,"videoPlaybackPositionEntity"),videoId:R,lastPlaybackPositionSeconds:"0"},Q.push(kU(q,R,"videoPlaybackPositionEntity")),G.userState={playbackPosition:R.key},Q.push(kU(q,
G,"mainVideoEntity")))}return g.IX.all(Q)})}),0):L.return()})};
g.e.Gi=function(){var b,L,q,V,Q,G,R,h,d,O,B,E,F,p,M,y,S,v,K,t,r,k,n,G$,L3,VJ,oY,Eo,qT,S5,f3,Nu,PJ,X2,Do,sT,v8,z;return g.P(function(UT){if(UT.U==1)return g.u(UT,fZ(),2);if(UT.U!=3){b=UT.L;if(!b)return UT.return();L=g.A2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.u(UT,CZ(b,{mode:"readonly",qo:!0},function(Cy){return g.IX.all([cX(Cy,L,"mainDownloadsListEntity"),cX(Cy,g.xv,"mainDownloadsListEntity"),PX(Cy,"mainVideoEntity"),PX(Cy,"mainPlaylistEntity")])}),3)}q=UT.L;
V=g.x(q);Q=V.next().value;G=V.next().value;R=V.next().value;h=V.next().value;d=Q;O=G;B=R;E=h;F=new Set;if((p=d)==null?0:(M=p.downloads)==null?0:M.length)for(y=g.x(d.downloads),S=y.next();!S.done;S=y.next())v=S.value,K=void 0,(t=(K=v.videoItem)!=null?K:v.playlistItem)&&F.add(t);if((r=O)==null?0:(k=r.downloads)==null?0:k.length)for(n=g.x(O.downloads),G$=n.next();!G$.done;G$=n.next())L3=G$.value,L3.videoItem&&F.add(L3.videoItem);VJ=new Set;oY=[];Eo=g.x(E);for(qT=Eo.next();!qT.done;qT=Eo.next()){S5=qT.value;
if(S5.videos)for(f3=g.x(S5.videos),Nu=f3.next();!Nu.done;Nu=f3.next())PJ=Nu.value,(X2=JSON.parse(g.lB(PJ).entityId).videoId)&&VJ.add(X2);S5.key&&!F.has(S5.key)&&oY.push(S5.key)}Do=g.x(B);for(sT=Do.next();!sT.done;sT=Do.next())v8=sT.value,v8.key&&!F.has(v8.key)&&(z=g.lB(v8.key).entityId,VJ.has(z)||oY.push(v8.key));return oY.length?g.u(UT,RKT(b,oY),0):UT.F8(0)})};g.Z($9w,K9);$9w.prototype.L=function(b){return oT(b)?zyW(this,b):hV(b)?g0s(this,b):dK(b)?KxR(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};
var mC=[10];g.Z(v0W,K9);v0W.prototype.L=function(b){return oT(b)?t7Q(this,b):hV(b)?a2_(this,b):dK(b)?rIW(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};
var s8=[10];g.Z(ub_,K9);ub_.prototype.L=function(b){return oT(b)?kz_(this,b):hV(b)?l2w(this,b):dK(b)?AIb(this,b):Promise.reject(Error("Unsupported action type: "+b.actionType))};
var n0q=[10];g.Z(XO,lX);XO.prototype.mu=function(b){var L=lX.prototype.mu.call(this,b);L.musicTrack=new ub_(b,this.U);L.musicPlaylist=new v0W(b,this.U);L.musicAlbumRelease=new $9w(b,this.U);return L};
XO.prototype.refreshAllStaleEntities=function(b,L){var q=this,V,Q,G;return g.P(function(R){if(R.U==1)return g.u(R,Cxb(q,b,L),2);if(R.U!=3)return Q=V=R.L,G=Q.concat,g.u(R,lX.prototype.refreshAllStaleEntities.call(q,b,L),3);V=G.call(Q,R.L);return R.return(V)})};g.Z(m9q,g.Eg);g.e=m9q.prototype;g.e.create=function(){var b=this;g.A(this,this.events);if(g.Nn(this.N))this.U=new SeW(this.N,this.player);else if(g.DG(this.N)||g.hu(this.N))this.U=new XO(this.N,this.player);this.events.K(this.player,"onPlaybackStartExternal",function(){b.Og()});
this.events.K(this.player,"videodatachange",function(){b.Og()});
this.N.T("html5_offline_playback_position_sync")&&this.events.K(this.player,"presentingplayerstatechange",this.Ht)};
g.e.sj=function(){return!1};
g.e.BQ=function(b,L,q,V){var Q=this;return g.P(function(G){return Q.U?G.return(AV(Q.U,b,L,q,V)):G.return(Promise.reject())})};
g.e.deleteAll=function(){return this.U.deleteAll()};
g.e.Y8=function(b){return this.U.Y8(b)};
g.e.refreshAllStaleEntities=function(b){return this.U.refreshAllStaleEntities(b)};
g.e.setUpPositionSyncInterval=function(b){this.U.setUpPositionSyncInterval(b)};
g.e.Dd=function(b){this.U.Dd(b)};
g.e.wy=function(b){return this.U.wy(b)};
g.e.Og=function(){var b=this,L;return g.P(function(q){L=b.player.getVideoData();return g.Gv(L)?sh8(L)&&b.L!==L.clientPlaybackNonce?g.u(q,X2W(b,L),0):q.F8(0):q.return()})};
g.e.Ht=function(b){var L=this,q,V,Q,G,R,h,d;return g.P(function(O){if(O.U==1)return q=L.player.getVideoData(),V=q.cM,g.E4(b,2)||g.E4(b,512)?g.u(O,fZ(),2):O.return();if(O.U!=3){Q=O.L;if(!Q)return L9("PES is undefined"),O.return();G=q.videoId;return g.u(O,sH(Q,g.A2(G,"mainVideoEntity"),"mainVideoEntity"),3)}R=O.L;if(!R)return O.return();h=Math.floor(V).toString();d={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:h}};return g.u(O,L.BQ([G],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
d),0)})};
g.e.isOrchestrationLeader=function(){return this.U.isOrchestrationLeader()};
g.e.updateDownloadState=function(b,L){var q,V,Q,G;return g.P(function(R){if(R.U==1)return g.u(R,fZ(),2);q=R.L;if(!q)return L9("PES is undefined"),R.return();V=g.lB(b);Q=V.entityType;G=V.entityId;return g.u(R,O8(G,Q,q,L,!0),0)})};g.BM("offline",m9q);})(_yt_player);
